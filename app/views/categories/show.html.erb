<div class="container" style="max-width: 1200px; margin: 0 auto; padding: 2rem 1rem;">
  <%= link_to "← Все категории", categories_path, style: "display: inline-block; margin-bottom: 2rem; color: var(--text-secondary); text-decoration: none; transition: color 0.2s;" %>

  <div style="margin-bottom: 3rem;">
    <h1 class="page-title" style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
      <%= @category.name %>
    </h1>

    <% if @category.description.present? %>
      <p style="color: var(--text-secondary); font-size: 1.125rem;">
        <%= @category.description %>
      </p>
    <% end %>
  </div>

  <% if @products.empty? %>
    <div class="glass-card" style="padding: 3rem; text-align: center;">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto 1.5rem; color: var(--text-secondary);">
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
      </svg>
      <p style="font-size: 1.25rem; color: var(--text-secondary); margin-bottom: 2rem;">
        В этой категории пока нет продуктов
      </p>
      <%= link_to "Смотреть другие категории", categories_path, class: "btn-primary", style: "display: inline-block; padding: 1rem 2rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; text-decoration: none; border-radius: 0.75rem; font-weight: 600; transition: all 0.3s ease;" %>
    </div>
  <% else %>
    <!-- Статистика -->
    <div style="margin-bottom: 2rem; padding: 1rem; background: var(--surface); border-radius: 0.75rem; display: inline-flex; align-items: center; gap: 0.5rem;">
      <span style="color: var(--text-secondary);">Найдено:</span>
      <span style="font-weight: 600; color: var(--accent);">
        <%= pluralize(@products.count, 'продукт', 'продукта', 'продуктов') %>
      </span>
    </div>

    <!-- Сетка продуктов -->
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem;">
      <% @products.each do |product| %>
        <%= link_to product_path(product), style: "text-decoration: none; color: inherit;" do %>
          <div class="glass-card product-card" style="padding: 0; height: 100%; overflow: hidden; transition: all 0.3s ease; cursor: pointer;">
            <!-- Изображение продукта -->
            <div style="height: 200px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); position: relative; display: flex; align-items: center; justify-content: center;">
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <%= product_type_icon_svg(product.product_type) %>
              </svg>

              <!-- Badge типа продукта -->
              <div style="position: absolute; top: 1rem; right: 1rem; padding: 0.5rem 1rem; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); border-radius: 9999px; font-size: 0.75rem; color: white; font-weight: 600;">
                <%= product_type_label(product.product_type) %>
              </div>

              <% if product.featured? %>
                <div style="position: absolute; top: 1rem; left: 1rem; padding: 0.5rem 1rem; background: rgba(245, 158, 11, 0.9); backdrop-filter: blur(10px); border-radius: 9999px; font-size: 0.75rem; color: white; font-weight: 600;">
                  ⭐ Популярное
                </div>
              <% end %>
            </div>

            <!-- Контент -->
            <div style="padding: 1.5rem;">
              <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 0.75rem; line-height: 1.4;">
                <%= product.name %>
              </h3>

              <p style="color: var(--text-secondary); font-size: 0.875rem; line-height: 1.6; margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                <%= product.description %>
              </p>

              <!-- Метаинформация -->
              <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.05);">
                <% if product.duration_minutes.present? %>
                  <span style="display: flex; align-items: center; gap: 0.25rem; color: var(--text-secondary); font-size: 0.75rem;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"></circle>
                      <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <%= duration_to_human(product.duration_minutes) %>
                  </span>
                <% end %>
              </div>

              <!-- Цена и кнопка -->
              <div style="display: flex; align-items: center; justify-content: space-between;">
                <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent);">
                  <%= humanized_money_with_symbol(product.price) %>
                </div>

                <span style="display: inline-flex; align-items: center; padding: 0.5rem 1rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600;">
                  Подробнее
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 0.5rem;">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                    <polyline points="12 5 19 12 12 19"></polyline>
                  </svg>
                </span>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>

<% content_for :helpers do %>
  <%
    def product_type_icon_svg(product_type)
      case product_type
      when 'video_course'
        '<path d="m22 8-6 4 6 4V8Z"></path><rect width="14" height="12" x="2" y="6" rx="2" ry="2"></rect>'.html_safe
      when 'book'
        '<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>'.html_safe
      when 'course'
        '<path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>'.html_safe
      when 'event'
        '<rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>'.html_safe
      else
        '<path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>'.html_safe
      end
    end

    def product_type_label(product_type)
      {
        'video_course' => 'Видеокурс',
        'book' => 'Книга',
        'course' => 'Курс',
        'service' => 'Услуга',
        'event' => 'Мероприятие'
      }[product_type] || product_type
    end

    def duration_to_human(minutes)
      return unless minutes

      hours = minutes / 60
      mins = minutes % 60

      if hours > 0 && mins > 0
        "#{hours} ч #{mins} мин"
      elsif hours > 0
        "#{hours} ч"
      else
        "#{mins} мин"
      end
    end
  %>
<% end %>
