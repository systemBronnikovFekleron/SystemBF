<% content_for :title, "–û–ø–ª–∞—Ç–∞ –∑–∞—è–≤–∫–∏ #{@order_request.request_number} - –°–∏—Å—Ç–µ–º–∞ –ë—Ä–æ–Ω–Ω–∏–∫–æ–≤–∞" %>

<section class="container" style="padding: 3rem 0; max-width: 800px;">
  <h1 class="text-gradient" style="margin-bottom: 2rem; text-align: center;">
    üí≥ –í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã
  </h1>

  <div class="card" style="margin-bottom: 2rem;">
    <div style="text-align: center; margin-bottom: 1.5rem;">
      <div style="font-size: 3rem; margin-bottom: 0.5rem;"><%= product_icon(@order_request.product.product_type) %></div>
      <h2 style="margin-bottom: 0.5rem;"><%= @order_request.product.name %></h2>
      <div style="font-size: 2rem; font-weight: 700; color: var(--color-primary-600);">
        <%= humanized_money_with_symbol(@order_request.total) %>
      </div>
    </div>
  </div>

  <!-- Current Balance -->
  <div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, var(--color-gray-50), var(--color-primary-50));">
    <h3 style="margin-bottom: 1rem;">üí∞ –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫–æ—à–µ–ª—å–∫–∞</h3>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
      <span style="color: var(--color-gray-700);">–î–æ—Å—Ç—É–ø–Ω–æ:</span>
      <span style="font-size: 1.5rem; font-weight: 700; color: var(--color-primary-600);">
        <%= humanized_money_with_symbol(@wallet.balance) %>
      </span>
    </div>

    <% if @shortfall > 0 %>
      <div style="padding: 1rem; background: var(--color-warning-50); border-left: 4px solid var(--color-warning); border-radius: 6px;">
        <p style="font-weight: 600; color: var(--color-warning); margin-bottom: 0.5rem;">
          ‚ö† –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
        </p>
        <p style="color: var(--color-gray-700);">
          –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –Ω–∞: <strong><%= humanized_money_with_symbol(Money.new(@shortfall, 'RUB')) %></strong>
        </p>
      </div>
    <% end %>
  </div>

  <!-- Payment Options -->
  <% if @wallet.sufficient_balance?(@order_request.total_kopecks) %>
    <!-- Option 1: Pay from Wallet -->
    <div class="card" style="margin-bottom: 1.5rem; border: 2px solid var(--color-success);">
      <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
        <div style="font-size: 3rem;">üí∞</div>
        <div style="flex: 1;">
          <h3 style="margin-bottom: 0.25rem;">–û–ø–ª–∞—Ç–∏—Ç—å —Å –∫–æ—à–µ–ª—å–∫–∞</h3>
          <p style="color: var(--color-gray-600); font-size: 0.875rem;">
            –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ, –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–∏
          </p>
        </div>
      </div>

      <%= button_to "–û–ø–ª–∞—Ç–∏—Ç—å —Å –∫–æ—à–µ–ª—å–∫–∞",
                    pay_order_request_path(@order_request),
                    method: :post,
                    class: "btn btn-success btn-lg",
                    style: "width: 100%;" %>
    </div>
  <% else %>
    <!-- Option 2: Top Up Wallet -->
    <div class="card" style="margin-bottom: 1.5rem; border: 2px solid var(--color-primary-600);">
      <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
        <div style="font-size: 3rem;">üí≥</div>
        <div style="flex: 1;">
          <h3 style="margin-bottom: 0.25rem;">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</h3>
          <p style="color: var(--color-gray-600); font-size: 0.875rem;">
            –ü–æ—Å–ª–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–∫—É–ø–∫–∞ –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
          </p>
        </div>
      </div>

      <div style="background: var(--color-info-50); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
        <p style="font-size: 0.875rem; color: var(--color-gray-700); margin-bottom: 0.5rem;">
          <strong>–°—É–º–º–∞ –∫ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—é:</strong>
        </p>
        <div style="font-size: 1.5rem; font-weight: 700; color: var(--color-primary-600);">
          <%= humanized_money_with_symbol(Money.new(@shortfall, 'RUB')) %>
        </div>
        <p style="font-size: 0.75rem; color: var(--color-gray-600); margin-top: 0.5rem;">
          (–º–∏–Ω–∏–º—É–º –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–∫—É–ø–∫–∏)
        </p>
      </div>

      <%= link_to "–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—é",
                  dashboard_wallet_path,
                  class: "btn btn-primary btn-lg",
                  style: "width: 100%;" %>
    </div>
  <% end %>

  <!-- Info Block -->
  <div class="card" style="background: var(--color-gray-50);">
    <h4 style="margin-bottom: 1rem;">‚ÑπÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h4>
    <ol style="padding-left: 1.5rem; display: flex; flex-direction: column; gap: 0.75rem;">
      <li style="color: var(--color-gray-700);">
        <% if @wallet.sufficient_balance?(@order_request.total_kopecks) %>
          –ù–∞–∂–º–∏—Ç–µ "–û–ø–ª–∞—Ç–∏—Ç—å —Å –∫–æ—à–µ–ª—å–∫–∞"
        <% else %>
          –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫ –Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é —Å—É–º–º—É
        <% end %>
      </li>
      <li style="color: var(--color-gray-700);">–°—Ä–µ–¥—Å—Ç–≤–∞ –±—É–¥—É—Ç —Å–ø–∏—Å–∞–Ω—ã —Å –≤–∞—à–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞</li>
      <li style="color: var(--color-gray-700);">–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
      <li style="color: var(--color-gray-700);">–î–æ—Å—Ç—É–ø –∫ –ø—Ä–æ–¥—É–∫—Ç—É –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ</li>
    </ol>
  </div>

  <div style="text-align: center; margin-top: 2rem;">
    <%= link_to "‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞—è–≤–∫–µ", order_request_path(@order_request), class: "btn btn-secondary" %>
  </div>
</section>
