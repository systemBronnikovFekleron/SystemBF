<% content_for :page_title, "–û–±–∑–æ—Ä" %>
<% content_for :page_subtitle, "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∞—à –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç" %>

<!-- Welcome Section -->
<div class="card fade-in" style="margin-bottom: var(--space-8); background: var(--blue-600); color: white; border: none;">
  <div style="position: relative; z-index: 1;">
    <h2 style="color: white; margin-bottom: var(--space-2); font-size: 1.5rem;">
      –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <%= @user.first_name %>! üëã
    </h2>
    <p style="opacity: 0.95; margin-bottom: var(--space-6); font-size: 0.9375rem;">
      –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–≤–æ–π –ø—É—Ç—å —Ä–∞–∑–≤–∏—Ç–∏—è. –í—ã –Ω–∞ <%= @stats[:active_days] %> –¥–Ω–µ –≤–∞—à–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è.
    </p>

    <div style="display: flex; gap: var(--space-3); flex-wrap: wrap;">
      <a href="/products" class="btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3);" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">
        –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∫—É—Ä—Å—ã
      </a>
      <a href="/dashboard/my-courses" class="btn" style="background: white; color: var(--blue-600);">
        –ú–æ–∏ –∫—É—Ä—Å—ã ‚Üí
      </a>
    </div>
  </div>
</div>

<!-- Stats Grid - 4 columns -->
<div class="grid" style="grid-template-columns: repeat(4, 1fr); gap: var(--space-4); margin-bottom: var(--space-8);">
  <div class="card" style="padding: var(--space-5);">
    <div style="font-size: 1.75rem; margin-bottom: var(--space-3);">üí∞</div>
    <div style="font-size: 1.5rem; font-weight: 600; color: var(--gray-900); margin-bottom: var(--space-1);"><%= format_currency(@user.wallet.balance_kopecks) %></div>
    <div style="font-size: 0.8125rem; color: var(--gray-600); margin-bottom: var(--space-3);">–ë–∞–ª–∞–Ω—Å –∫–æ—à–µ–ª—å–∫–∞</div>
    <a href="/dashboard/wallet" style="font-size: 0.8125rem; color: var(--blue-600); text-decoration: none;">
      –ü–æ–ø–æ–ª–Ω–∏—Ç—å ‚Üí
    </a>
  </div>

  <div class="card" style="padding: var(--space-5);">
    <div style="font-size: 1.75rem; margin-bottom: var(--space-3);">‚≠ê</div>
    <div style="font-size: 1.5rem; font-weight: 600; color: var(--gray-900); margin-bottom: var(--space-1);"><%= @user.rating.points %></div>
    <div style="font-size: 0.8125rem; color: var(--gray-600); margin-bottom: var(--space-3);">–†–µ–π—Ç–∏–Ω–≥ (–£—Ä. <%= @user.rating.level %>)</div>
    <div style="width: 100%; height: 4px; background: var(--gray-200); border-radius: 2px; overflow: hidden;">
      <div style="width: <%= [@user.rating.points % 100, 100].min %>%; height: 100%; background: var(--blue-500); transition: width 0.5s;"></div>
    </div>
  </div>

  <div class="card" style="padding: var(--space-5);">
    <div style="font-size: 1.75rem; margin-bottom: var(--space-3);">üì¶</div>
    <div style="font-size: 1.5rem; font-weight: 600; color: var(--gray-900); margin-bottom: var(--space-1);"><%= @stats[:total_orders] %></div>
    <div style="font-size: 0.8125rem; color: var(--gray-600); margin-bottom: var(--space-3);">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
    <a href="/dashboard/orders" style="font-size: 0.8125rem; color: var(--blue-600); text-decoration: none;">
      –°–º–æ—Ç—Ä–µ—Ç—å ‚Üí
    </a>
  </div>

  <div class="card" style="padding: var(--space-5);">
    <div style="font-size: 1.75rem; margin-bottom: var(--space-3);">üéì</div>
    <div style="font-size: 1.5rem; font-weight: 600; color: var(--gray-900); margin-bottom: var(--space-1);"><%= @product_accesses.count %></div>
    <div style="font-size: 0.8125rem; color: var(--gray-600); margin-bottom: var(--space-3);">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫—É—Ä—Å–æ–≤</div>
    <a href="/dashboard/my-courses" style="font-size: 0.8125rem; color: var(--blue-600); text-decoration: none;">
      –û—Ç–∫—Ä—ã—Ç—å ‚Üí
    </a>
  </div>
</div>

<!-- Main Content Grid - 3 columns -->
<div class="grid" style="grid-template-columns: 2fr 1fr 1fr; gap: var(--space-6);">
  <!-- Recent Orders - 1 column -->
  <div>
    <div class="card fade-in">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-5);">
        <h3 style="font-size: 1.125rem; font-weight: 600;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h3>
        <a href="/dashboard/orders" style="font-size: 0.875rem; color: var(--blue-600); text-decoration: none;">
          –í—Å–µ –∑–∞–∫–∞–∑—ã ‚Üí
        </a>
      </div>

      <% if @recent_orders.any? %>
        <div style="display: flex; flex-direction: column; gap: var(--space-3);">
          <% @recent_orders.each do |order| %>
            <div style="
              padding: var(--space-4);
              border: 1px solid var(--gray-200);
              border-radius: var(--radius-md);
              transition: all var(--transition-base);
              cursor: pointer;
            " onmouseover="this.style.borderColor='var(--blue-300)'; this.style.background='var(--gray-50)'" onmouseout="this.style.borderColor='var(--gray-200)'; this.style.background='transparent'" onclick="window.location.href='/orders/<%= order.id %>'">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-2);">
                <div>
                  <div style="font-weight: 600; color: var(--gray-900); margin-bottom: var(--space-1); font-size: 0.9375rem;">
                    –ó–∞–∫–∞–∑ #<%= order.order_number %>
                  </div>
                  <div style="font-size: 0.8125rem; color: var(--gray-600);">
                    <%= order.created_at.strftime('%d.%m.%Y %H:%M') %>
                  </div>
                </div>
                <div style="text-align: right;">
                  <div style="font-weight: 600; color: var(--blue-600); margin-bottom: var(--space-1);">
                    <%= order.total.format %>
                  </div>
                  <% case order.status %>
                  <% when 'paid', 'completed' %>
                    <span class="badge badge-success"><%= order.status == 'paid' ? '–û–ø–ª–∞—á–µ–Ω' : '–ó–∞–≤–µ—Ä—à–µ–Ω' %></span>
                  <% when 'pending' %>
                    <span class="badge badge-warning">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                  <% when 'failed' %>
                    <span class="badge badge-error">–û—Ç–º–µ–Ω–µ–Ω</span>
                  <% end %>
                </div>
              </div>
              <div style="font-size: 0.875rem; color: var(--gray-700);">
                <%= order.order_items.count %> <%= '—Ç–æ–≤–∞—Ä'.pluralize(order.order_items.count) %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div style="text-align: center; padding: var(--space-10) var(--space-4); color: var(--gray-600);">
          <div style="font-size: 3rem; margin-bottom: var(--space-4); opacity: 0.3;">üì¶</div>
          <div style="margin-bottom: var(--space-4);">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>
          <a href="/products" class="btn btn-primary">
            –ù–∞—á–∞—Ç—å –ø–æ–∫—É–ø–∫–∏
          </a>
        </div>
      <% end %>
    </div>
  </div>

  <!-- My Courses - 1 column -->
  <div>
    <div class="card fade-in">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-5);">
        <h3 style="font-size: 1.125rem; font-weight: 600;">–ú–æ–∏ –∫—É—Ä—Å—ã</h3>
        <a href="/dashboard/my-courses" style="font-size: 0.875rem; color: var(--blue-600); text-decoration: none;">
          –í—Å–µ ‚Üí
        </a>
      </div>

      <% if @product_accesses.any? %>
        <div style="display: flex; flex-direction: column; gap: var(--space-3);">
          <% @product_accesses.each do |access| %>
            <div style="
              padding: var(--space-3);
              border: 1px solid var(--gray-200);
              border-radius: var(--radius-md);
              transition: all var(--transition-base);
              cursor: pointer;
            " onmouseover="this.style.borderColor='var(--blue-300)'; this.style.background='var(--gray-50)'" onmouseout="this.style.borderColor='var(--gray-200)'; this.style.background='transparent'" onclick="window.location.href='/products/<%= access.product.slug %>'">
              <div style="display: flex; align-items: center; gap: var(--space-3); margin-bottom: var(--space-3);">
                <div style="
                  width: 40px;
                  height: 40px;
                  border-radius: var(--radius-md);
                  background: var(--blue-50);
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 1.25rem;
                  flex-shrink: 0;
                ">
                  <%= product_icon(access.product.product_type) %>
                </div>
                <div style="flex: 1; min-width: 0;">
                  <div style="font-weight: 500; color: var(--gray-900); font-size: 0.875rem; margin-bottom: var(--space-1); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                    <%= access.product.name %>
                  </div>
                  <div style="font-size: 0.75rem; color: var(--gray-600);">
                    <%= product_type_label(access.product.product_type) %>
                  </div>
                </div>
              </div>

              <!-- Progress bar -->
              <div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-1);">
                  <span style="font-size: 0.75rem; color: var(--gray-600);">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                  <span style="font-size: 0.75rem; font-weight: 600; color: var(--blue-600);">
                    <%= rand(20..80) %>%
                  </span>
                </div>
                <div style="width: 100%; height: 4px; background: var(--gray-200); border-radius: 2px; overflow: hidden;">
                  <div style="width: <%= rand(20..80) %>%; height: 100%; background: var(--blue-500);"></div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div style="text-align: center; padding: var(--space-8) var(--space-4); color: var(--gray-600);">
          <div style="font-size: 2.5rem; margin-bottom: var(--space-3); opacity: 0.3;">üéì</div>
          <div style="font-size: 0.875rem; margin-bottom: var(--space-4);">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—É—Ä—Å–æ–≤</div>
          <a href="/products?product_type=course" class="btn btn-outline btn-sm">
            –í—ã–±—Ä–∞—Ç—å –∫—É—Ä—Å
          </a>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Quick Actions - 1 column -->
  <div>
    <div class="card fade-in">
      <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-4);">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>

      <div style="display: flex; flex-direction: column; gap: var(--space-2);">
        <a href="/dashboard/wallet" style="
          display: flex;
          align-items: center;
          gap: var(--space-3);
          padding: var(--space-3);
          border-radius: var(--radius-md);
          background: var(--gray-50);
          text-decoration: none;
          transition: all var(--transition-base);
          border: 1px solid transparent;
        " onmouseover="this.style.background='var(--blue-50)'; this.style.borderColor='var(--blue-200)'" onmouseout="this.style.background='var(--gray-50)'; this.style.borderColor='transparent'">
          <span style="font-size: 1.25rem;">üí≥</span>
          <span style="color: var(--gray-800); font-weight: 500; font-size: 0.875rem;">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</span>
        </a>

        <a href="/products" style="
          display: flex;
          align-items: center;
          gap: var(--space-3);
          padding: var(--space-3);
          border-radius: var(--radius-md);
          background: var(--gray-50);
          text-decoration: none;
          transition: all var(--transition-base);
          border: 1px solid transparent;
        " onmouseover="this.style.background='var(--blue-50)'; this.style.borderColor='var(--blue-200)'" onmouseout="this.style.background='var(--gray-50)'; this.style.borderColor='transparent'">
          <span style="font-size: 1.25rem;">üõçÔ∏è</span>
          <span style="color: var(--gray-800); font-weight: 500; font-size: 0.875rem;">–ú–∞–≥–∞–∑–∏–Ω</span>
        </a>

        <a href="/dashboard/achievements" style="
          display: flex;
          align-items: center;
          gap: var(--space-3);
          padding: var(--space-3);
          border-radius: var(--radius-md);
          background: var(--gray-50);
          text-decoration: none;
          transition: all var(--transition-base);
          border: 1px solid transparent;
        " onmouseover="this.style.background='var(--blue-50)'; this.style.borderColor='var(--blue-200)'" onmouseout="this.style.background='var(--gray-50)'; this.style.borderColor='transparent'">
          <span style="font-size: 1.25rem;">üèÜ</span>
          <span style="color: var(--gray-800); font-weight: 500; font-size: 0.875rem;">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
        </a>
      </div>
    </div>
  </div>
</div>

<style>
  @media (max-width: 1280px) {
    /* Stats: 2 columns on tablets */
    .grid:first-of-type {
      grid-template-columns: repeat(2, 1fr) !important;
    }

    /* Main grid: stack on tablets */
    .grid:last-of-type {
      grid-template-columns: 1fr !important;
    }
  }

  @media (max-width: 768px) {
    /* Stats: 1 column on mobile */
    .grid:first-of-type {
      grid-template-columns: 1fr !important;
    }
  }
</style>
