<% content_for :page_title, "–û–±–∑–æ—Ä" %>
<% content_for :page_subtitle, "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∞—à –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç" %>

<!-- Welcome Section -->
<div class="card fade-in" style="margin-bottom: 2rem; background: linear-gradient(135deg, var(--color-primary-600), var(--color-secondary-600)); color: white; position: relative; overflow: hidden;">
  <div style="position: absolute; inset: 0; background-image: radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 1px, transparent 1px); background-size: 30px 30px; opacity: 0.3;"></div>

  <div style="position: relative; z-index: 1;">
    <h2 style="color: white; margin-bottom: 0.5rem; font-size: 1.75rem;">
      –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <%= @user.first_name %>! üëã
    </h2>
    <p style="opacity: 0.9; margin-bottom: 1.5rem;">
      –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Å–≤–æ–π –ø—É—Ç—å —Ä–∞–∑–≤–∏—Ç–∏—è. –í—ã –Ω–∞ <%= @stats[:active_days] %> –¥–Ω–µ –≤–∞—à–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è.
    </p>

    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
      <a href="/products" class="btn" style="background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3);" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'">
        –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∫—É—Ä—Å—ã
      </a>
      <a href="/dashboard/my-courses" class="btn" style="background: white; color: var(--color-primary-600);">
        –ú–æ–∏ –∫—É—Ä—Å—ã ‚Üí
      </a>
    </div>
  </div>
</div>

<!-- Stats Grid -->
<div class="grid md:grid-cols-4 gap-4 fade-in stagger-1" style="margin-bottom: 2rem;">
  <div class="stat-card">
    <div class="stat-icon">üí∞</div>
    <div class="stat-value"><%= format_currency(@user.wallet.balance_kopecks) %></div>
    <div class="stat-label">–ë–∞–ª–∞–Ω—Å –∫–æ—à–µ–ª—å–∫–∞</div>
    <a href="/dashboard/wallet" style="font-size: 0.75rem; color: var(--color-primary-600); text-decoration: none; margin-top: 0.5rem; display: inline-block;">
      –ü–æ–ø–æ–ª–Ω–∏—Ç—å ‚Üí
    </a>
  </div>

  <div class="stat-card">
    <div class="stat-icon">‚≠ê</div>
    <div class="stat-value"><%= @user.rating.points %></div>
    <div class="stat-label">–†–µ–π—Ç–∏–Ω–≥ (–£—Ä. <%= @user.rating.level %>)</div>
    <div style="width: 100%; height: 4px; background: var(--color-gray-200); border-radius: 2px; margin-top: 0.5rem; overflow: hidden;">
      <div style="width: <%= [@user.rating.points % 100, 100].min %>%; height: 100%; background: linear-gradient(90deg, var(--color-primary-500), var(--color-secondary-500)); transition: width 0.5s;"></div>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-icon">üì¶</div>
    <div class="stat-value"><%= @stats[:total_orders] %></div>
    <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
    <a href="/dashboard/orders" style="font-size: 0.75rem; color: var(--color-primary-600); text-decoration: none; margin-top: 0.5rem; display: inline-block;">
      –°–º–æ—Ç—Ä–µ—Ç—å ‚Üí
    </a>
  </div>

  <div class="stat-card">
    <div class="stat-icon">üéì</div>
    <div class="stat-value"><%= @product_accesses.count %></div>
    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫—É—Ä—Å–æ–≤</div>
    <a href="/dashboard/my-courses" style="font-size: 0.75rem; color: var(--color-primary-600); text-decoration: none; margin-top: 0.5rem; display: inline-block;">
      –û—Ç–∫—Ä—ã—Ç—å ‚Üí
    </a>
  </div>
</div>

<!-- Main Content Grid -->
<div class="grid lg:grid-cols-3 gap-6">
  <!-- Recent Orders -->
  <div class="lg:col-span-2">
    <div class="card fade-in stagger-2">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h3 style="font-size: 1.25rem; font-weight: 600;">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h3>
        <a href="/dashboard/orders" style="font-size: 0.875rem; color: var(--color-primary-600); text-decoration: none;">
          –í—Å–µ –∑–∞–∫–∞–∑—ã ‚Üí
        </a>
      </div>

      <% if @recent_orders.any? %>
        <div style="display: flex; flex-direction: column; gap: 1rem;">
          <% @recent_orders.each do |order| %>
            <div style="
              padding: 1rem;
              border: 1px solid var(--color-gray-200);
              border-radius: 0.75rem;
              transition: all 0.2s;
              cursor: pointer;
            " onmouseover="this.style.borderColor='var(--color-primary-300)'; this.style.background='var(--color-gray-50)'" onmouseout="this.style.borderColor='var(--color-gray-200)'; this.style.background='transparent'" onclick="window.location.href='/orders/<%= order.id %>'">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                <div>
                  <div style="font-weight: 600; color: var(--color-gray-900); margin-bottom: 0.25rem;">
                    –ó–∞–∫–∞–∑ #<%= order.order_number %>
                  </div>
                  <div style="font-size: 0.75rem; color: var(--color-gray-600);">
                    <%= order.created_at.strftime('%d.%m.%Y %H:%M') %>
                  </div>
                </div>
                <div style="text-align: right;">
                  <div style="font-weight: 700; color: var(--color-primary-600); margin-bottom: 0.25rem;">
                    <%= order.total.format %>
                  </div>
                  <% case order.status %>
                  <% when 'paid', 'completed' %>
                    <span class="badge badge-success"><%= order.status == 'paid' ? '–û–ø–ª–∞—á–µ–Ω' : '–ó–∞–≤–µ—Ä—à–µ–Ω' %></span>
                  <% when 'pending' %>
                    <span class="badge badge-warning">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                  <% when 'failed' %>
                    <span class="badge badge-error">–û—Ç–º–µ–Ω–µ–Ω</span>
                  <% end %>
                </div>
              </div>
              <div style="font-size: 0.875rem; color: var(--color-gray-600);">
                <%= order.order_items.count %> <%= '—Ç–æ–≤–∞—Ä'.pluralize(order.order_items.count) %>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div style="text-align: center; padding: 3rem 1rem; color: var(--color-gray-500);">
          <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">üì¶</div>
          <div>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>
          <a href="/products" class="btn btn-primary" style="margin-top: 1rem;">
            –ù–∞—á–∞—Ç—å –ø–æ–∫—É–ø–∫–∏
          </a>
        </div>
      <% end %>
    </div>
  </div>

  <!-- My Courses -->
  <div>
    <div class="card fade-in stagger-3">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h3 style="font-size: 1.25rem; font-weight: 600;">–ú–æ–∏ –∫—É—Ä—Å—ã</h3>
        <a href="/dashboard/my-courses" style="font-size: 0.875rem; color: var(--color-primary-600); text-decoration: none;">
          –í—Å–µ ‚Üí
        </a>
      </div>

      <% if @product_accesses.any? %>
        <div style="display: flex; flex-direction: column; gap: 1rem;">
          <% @product_accesses.each do |access| %>
            <div style="
              padding: 1rem;
              border: 1px solid var(--color-gray-200);
              border-radius: 0.75rem;
              transition: all 0.2s;
              cursor: pointer;
            " onmouseover="this.style.borderColor='var(--color-primary-300)'; this.style.background='var(--color-gray-50)'" onmouseout="this.style.borderColor='var(--color-gray-200)'; this.style.background='transparent'" onclick="window.location.href='/products/<%= access.product.slug %>'">
              <div style="display: flex; align-items: center; gap: 0.75rem;">
                <div style="
                  width: 3rem;
                  height: 3rem;
                  border-radius: 0.5rem;
                  background: linear-gradient(135deg, var(--color-primary-100), var(--color-secondary-100));
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 1.5rem;
                ">
                  <%= product_icon(access.product.product_type) %>
                </div>
                <div style="flex: 1; min-width: 0;">
                  <div style="font-weight: 600; color: var(--color-gray-900); font-size: 0.875rem; margin-bottom: 0.25rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                    <%= access.product.name %>
                  </div>
                  <div style="font-size: 0.75rem; color: var(--color-gray-600);">
                    <%= product_type_label(access.product.product_type) %>
                  </div>
                </div>
              </div>

              <!-- Progress bar placeholder -->
              <div style="margin-top: 0.75rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                  <span style="font-size: 0.75rem; color: var(--color-gray-600);">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                  <span style="font-size: 0.75rem; font-weight: 600; color: var(--color-primary-600);">
                    <%= rand(20..80) %>%
                  </span>
                </div>
                <div style="width: 100%; height: 4px; background: var(--color-gray-200); border-radius: 2px; overflow: hidden;">
                  <div style="width: <%= rand(20..80) %>%; height: 100%; background: linear-gradient(90deg, var(--color-primary-500), var(--color-secondary-500));"></div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div style="text-align: center; padding: 2rem 1rem; color: var(--color-gray-500);">
          <div style="font-size: 2.5rem; margin-bottom: 0.75rem; opacity: 0.5;">üéì</div>
          <div style="font-size: 0.875rem;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—É—Ä—Å–æ–≤</div>
          <a href="/products?product_type=course" class="btn btn-outline btn-sm" style="margin-top: 1rem;">
            –í—ã–±—Ä–∞—Ç—å –∫—É—Ä—Å
          </a>
        </div>
      <% end %>
    </div>

    <!-- Quick Actions Card -->
    <div class="card fade-in stagger-4" style="margin-top: 1.5rem;">
      <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem;">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>

      <div style="display: flex; flex-direction: column; gap: 0.75rem;">
        <a href="/dashboard/wallet" style="
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.75rem;
          border-radius: 0.5rem;
          background: var(--color-gray-50);
          text-decoration: none;
          transition: all 0.2s;
        " onmouseover="this.style.background='var(--color-primary-50)'" onmouseout="this.style.background='var(--color-gray-50)'">
          <span style="font-size: 1.5rem;">üí≥</span>
          <span style="color: var(--color-gray-700); font-weight: 500;">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</span>
        </a>

        <a href="/products" style="
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.75rem;
          border-radius: 0.5rem;
          background: var(--color-gray-50);
          text-decoration: none;
          transition: all 0.2s;
        " onmouseover="this.style.background='var(--color-primary-50)'" onmouseout="this.style.background='var(--color-gray-50)'">
          <span style="font-size: 1.5rem;">üõçÔ∏è</span>
          <span style="color: var(--color-gray-700); font-weight: 500;">–ú–∞–≥–∞–∑–∏–Ω</span>
        </a>

        <a href="/dashboard/achievements" style="
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.75rem;
          border-radius: 0.5rem;
          background: var(--color-gray-50);
          text-decoration: none;
          transition: all 0.2s;
        " onmouseover="this.style.background='var(--color-primary-50)'" onmouseout="this.style.background='var(--color-gray-50)'">
          <span style="font-size: 1.5rem;">üèÜ</span>
          <span style="color: var(--color-gray-700); font-weight: 500;">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</span>
        </a>
      </div>
    </div>
  </div>
</div>
