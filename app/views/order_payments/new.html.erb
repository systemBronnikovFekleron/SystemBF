<div class="container" style="max-width: 600px; margin: 0 auto; padding: 2rem 1rem;">
  <h1 class="page-title" style="font-size: 2.5rem; font-weight: 700; margin-bottom: 2rem; text-align: center; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
    Оплата заказа
  </h1>

  <div class="glass-card" style="padding: 2rem;">
    <!-- Информация о заказе -->
    <div style="margin-bottom: 2rem; text-align: center;">
      <div style="color: var(--gray-600); font-size: 0.875rem; margin-bottom: 0.5rem;">
        Заказ № <%= @order.order_number %>
      </div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--accent);">
        <%= humanized_money_with_symbol(@order.total) %>
      </div>
    </div>

    <!-- Список товаров -->
    <div style="margin-bottom: 2rem; padding: 1.5rem; background: white; border-radius: 0.75rem;">
      <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--gray-600);">
        Товары в заказе:
      </h3>
      <% @order.order_items.each do |item| %>
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
          <span style="color: var(--gray-900);"><%= item.product.name %></span>
          <span style="font-weight: 600; color: var(--gray-900);"><%= humanized_money_with_symbol(item.price * item.quantity) %></span>
        </div>
      <% end %>
    </div>

    <!-- Форма оплаты CloudPayments -->
    <%= form_with url: order_payment_path(@order), method: :post, data: { controller: "payment" } do |form| %>
      <div style="margin-bottom: 1.5rem;">
        <label style="display: block; margin-bottom: 0.5rem; color: var(--gray-600); font-size: 0.875rem; font-weight: 500;">
          Номер карты
        </label>
        <input
          type="text"
          name="card_number"
          placeholder="1234 5678 9012 3456"
          maxlength="19"
          data-payment-target="cardNumber"
          data-action="input->payment#formatCardNumber"
          style="width: 100%; padding: 0.75rem 1rem; background: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 0.5rem; color: var(--gray-900); font-size: 1rem;"
          required
        >
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
        <div>
          <label style="display: block; margin-bottom: 0.5rem; color: var(--gray-600); font-size: 0.875rem; font-weight: 500;">
            Срок действия
          </label>
          <input
            type="text"
            name="expiry"
            placeholder="MM/YY"
            maxlength="5"
            data-payment-target="expiry"
            data-action="input->payment#formatExpiry"
            style="width: 100%; padding: 0.75rem 1rem; background: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 0.5rem; color: var(--gray-900); font-size: 1rem;"
            required
          >
        </div>

        <div>
          <label style="display: block; margin-bottom: 0.5rem; color: var(--gray-600); font-size: 0.875rem; font-weight: 500;">
            CVV
          </label>
          <input
            type="text"
            name="cvv"
            placeholder="123"
            maxlength="3"
            data-payment-target="cvv"
            style="width: 100%; padding: 0.75rem 1rem; background: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 0.5rem; color: var(--gray-900); font-size: 1rem;"
            required
          >
        </div>
      </div>

      <div style="margin-bottom: 1.5rem;">
        <label style="display: block; margin-bottom: 0.5rem; color: var(--gray-600); font-size: 0.875rem; font-weight: 500;">
          Имя владельца карты
        </label>
        <input
          type="text"
          name="cardholder_name"
          placeholder="IVAN IVANOV"
          value="<%= current_user.profile&.full_name&.upcase %>"
          style="width: 100%; padding: 0.75rem 1rem; background: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 0.5rem; color: var(--gray-900); font-size: 1rem; text-transform: uppercase;"
          required
        >
      </div>

      <button
        type="submit"
        data-payment-target="submitButton"
        style="width: 100%; padding: 1rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; border-radius: 0.75rem; font-weight: 600; font-size: 1.125rem; cursor: pointer; transition: all 0.3s ease; margin-bottom: 1rem;"
      >
        Оплатить <%= humanized_money_with_symbol(@order.total) %>
      </button>

      <%= link_to "Отменить", @order, style: "display: block; text-align: center; color: var(--gray-600); text-decoration: none; font-size: 0.875rem; transition: color 0.2s;" %>
    <% end %>

    <!-- Информация о безопасности -->
    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 0.75rem; color: var(--gray-600); font-size: 0.875rem;">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; color: var(--accent);">
        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
      </svg>
      <span>Безопасная оплата через CloudPayments. Данные вашей карты защищены.</span>
    </div>
  </div>

  <!-- Тестовая информация (только для разработки) -->
  <% if Rails.env.development? %>
    <div style="margin-top: 2rem; padding: 1rem; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 0.5rem; font-size: 0.875rem; color: var(--gray-600);">
      <strong style="color: var(--accent);">Режим разработки:</strong> После нажатия "Оплатить" заказ будет автоматически помечен как оплаченный для тестирования. В продакшене здесь будет интеграция с CloudPayments.
    </div>
  <% end %>
</div>
