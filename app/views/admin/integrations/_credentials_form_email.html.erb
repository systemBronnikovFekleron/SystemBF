<% credentials = integration.credentials_hash %>

<div style="margin-bottom: var(--space-5);">
  <%= label_tag 'integration_setting[credentials][smtp_address]', 'SMTP Сервер', style: "display: block; font-weight: 600; color: var(--gray-700); margin-bottom: var(--space-2);" %>
  <%= text_field_tag 'integration_setting[credentials][smtp_address]', credentials[:smtp_address], placeholder: 'smtp.example.com', style: "width: 100%; padding: var(--space-3); border: 2px solid var(--gray-200); border-radius: var(--radius-md); font-size: 1rem;" %>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4); margin-bottom: var(--space-5);">
  <div>
    <%= label_tag 'integration_setting[credentials][smtp_port]', 'Порт', style: "display: block; font-weight: 600; color: var(--gray-700); margin-bottom: var(--space-2);" %>
    <%= text_field_tag 'integration_setting[credentials][smtp_port]', credentials[:smtp_port] || '587', placeholder: '587', style: "width: 100%; padding: var(--space-3); border: 2px solid var(--gray-200); border-radius: var(--radius-md); font-size: 1rem;" %>
  </div>

  <div>
    <%= label_tag 'integration_setting[credentials][smtp_authentication]', 'Аутентификация', style: "display: block; font-weight: 600; color: var(--gray-700); margin-bottom: var(--space-2);" %>
    <%= select_tag 'integration_setting[credentials][smtp_authentication]',
        options_for_select([['Plain', 'plain'], ['Login', 'login'], ['CRAM-MD5', 'cram_md5']], credentials[:smtp_authentication] || 'plain'),
        style: "width: 100%; padding: var(--space-3); border: 2px solid var(--gray-200); border-radius: var(--radius-md); font-size: 1rem;" %>
  </div>
</div>

<div style="margin-bottom: var(--space-5);">
  <%= label_tag 'integration_setting[credentials][smtp_domain]', 'Домен', style: "display: block; font-weight: 600; color: var(--gray-700); margin-bottom: var(--space-2);" %>
  <%= text_field_tag 'integration_setting[credentials][smtp_domain]', credentials[:smtp_domain], placeholder: 'example.com', style: "width: 100%; padding: var(--space-3); border: 2px solid var(--gray-200); border-radius: var(--radius-md); font-size: 1rem;" %>
</div>

<div style="margin-bottom: var(--space-5);">
  <%= label_tag 'integration_setting[credentials][smtp_user_name]', 'Имя пользователя', style: "display: block; font-weight: 600; color: var(--gray-700); margin-bottom: var(--space-2);" %>
  <%= text_field_tag 'integration_setting[credentials][smtp_user_name]', credentials[:smtp_user_name], placeholder: 'user@example.com', style: "width: 100%; padding: var(--space-3); border: 2px solid var(--gray-200); border-radius: var(--radius-md); font-size: 1rem;" %>
</div>

<div style="margin-bottom: var(--space-5);">
  <%= label_tag 'integration_setting[credentials][smtp_password]', 'Пароль', style: "display: block; font-weight: 600; color: var(--gray-700); margin-bottom: var(--space-2);" %>
  <%= password_field_tag 'integration_setting[credentials][smtp_password]', credentials[:smtp_password], placeholder: credentials[:smtp_password].present? ? '••••••••' : 'Введите пароль', style: "width: 100%; padding: var(--space-3); border: 2px solid var(--gray-200); border-radius: var(--radius-md); font-size: 1rem;" %>
  <% if credentials[:smtp_password].present? %>
    <p style="font-size: 0.75rem; color: var(--gray-600); margin-top: var(--space-2);">
      Текущий пароль: <%= integration.masked_credentials[:smtp_password] %>. Оставьте поле пустым, чтобы не изменять.
    </p>
  <% end %>
</div>

<div style="display: flex; align-items: center; gap: var(--space-3); padding: var(--space-3); background: var(--gray-50); border-radius: var(--radius-md);">
  <%= check_box_tag 'integration_setting[credentials][smtp_enable_starttls_auto]', 'true', credentials[:smtp_enable_starttls_auto] != 'false', style: "width: 18px; height: 18px; cursor: pointer;" %>
  <%= label_tag 'integration_setting[credentials][smtp_enable_starttls_auto]', 'Включить STARTTLS (рекомендуется)', style: "font-weight: 500; color: var(--gray-700); cursor: pointer;" %>
</div>
