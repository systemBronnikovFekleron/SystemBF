<% content_for :title, @integration.name %>

<div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-8);">
  <div>
    <%= link_to admin_integrations_path, style: "display: inline-flex; align-items: center; gap: var(--space-2); color: var(--gray-600); text-decoration: none; font-size: 0.875rem; margin-bottom: var(--space-3);" do %>
      ← Все интеграции
    <% end %>
    <h1 style="font-size: 1.875rem; font-weight: 700; color: var(--gray-900);">
      <%= @integration.name %>
    </h1>
    <p style="color: var(--gray-600); margin-top: var(--space-2);"><%= @integration.description %></p>
  </div>

  <div style="display: flex; gap: var(--space-3);">
    <%= link_to 'Редактировать', edit_admin_integration_path(@integration), style: "padding: var(--space-3) var(--space-5); background: var(--primary); color: white; border-radius: var(--radius-md); text-decoration: none; font-weight: 500;" %>
    <%= button_to 'Проверить подключение', test_connection_admin_integration_path(@integration), style: "padding: var(--space-3) var(--space-5); background: var(--gray-100); color: var(--gray-700); border: 1px solid var(--gray-200); border-radius: var(--radius-md); font-weight: 500; cursor: pointer;" %>
    <% if @integration.enabled? %>
      <%= button_to 'Отключить', toggle_status_admin_integration_path(@integration), style: "padding: var(--space-3) var(--space-5); background: #ef4444; color: white; border: none; border-radius: var(--radius-md); font-weight: 500; cursor: pointer;" %>
    <% else %>
      <%= button_to 'Включить', toggle_status_admin_integration_path(@integration), style: "padding: var(--space-3) var(--space-5); background: #16a34a; color: white; border: none; border-radius: var(--radius-md); font-weight: 500; cursor: pointer;" %>
    <% end %>
  </div>
</div>

<!-- Statistics Grid -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: var(--space-4); margin-bottom: var(--space-6);">
  <div class="card" style="padding: var(--space-6);">
    <div style="display: flex; align-items: center; gap: var(--space-4); margin-bottom: var(--space-4);">
      <div style="width: 48px; height: 48px; background: rgba(79, 70, 229, 0.05); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
        </svg>
      </div>
      <div>
        <div style="font-size: 0.75rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-1);">
          Всего использований
        </div>
        <div style="font-size: 1.875rem; font-weight: 700; color: var(--gray-900);">
          <%= number_with_delimiter(@integration.usage_count) %>
        </div>
      </div>
    </div>
    <% if @integration.last_used_at %>
      <div style="font-size: 0.875rem; color: var(--gray-600);">
        Последнее: <%= time_ago_in_words(@integration.last_used_at) %> назад
      </div>
    <% end %>
  </div>

  <div class="card" style="padding: var(--space-6);">
    <div style="display: flex; align-items: center; gap: var(--space-4); margin-bottom: var(--space-4);">
      <div style="width: 48px; height: 48px; background: rgba(34, 197, 94, 0.1); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#22C55E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </div>
      <div>
        <div style="font-size: 0.75rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-1);">
          Успешно (сегодня)
        </div>
        <div style="font-size: 1.875rem; font-weight: 700; color: var(--gray-900);">
          <%= @integration.integration_logs.today.successful.count %>
        </div>
      </div>
    </div>
    <div style="font-size: 0.875rem; color: var(--color-success);">
      <%= @integration.integration_logs.today.count %> событий
    </div>
  </div>

  <div class="card" style="padding: var(--space-6);">
    <div style="display: flex; align-items: center; gap: var(--space-4); margin-bottom: var(--space-4);">
      <div style="width: 48px; height: 48px; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
      </div>
      <div>
        <div style="font-size: 0.75rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-1);">
          Ошибок (сегодня)
        </div>
        <div style="font-size: 1.875rem; font-weight: 700; color: var(--gray-900);">
          <%= @integration.integration_logs.today.failed.count %>
        </div>
      </div>
    </div>
  </div>

  <div class="card" style="padding: var(--space-6);">
    <div style="display: flex; align-items: center; gap: var(--space-4); margin-bottom: var(--space-4);">
      <div style="width: 48px; height: 48px; background: <%= @integration.healthy? ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)' %>; border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="<%= @integration.healthy? ? '#22C55E' : '#ef4444' %>" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
        </svg>
      </div>
      <div>
        <div style="font-size: 0.75rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-1);">
          Здоровье
        </div>
        <div style="font-size: 1.875rem; font-weight: 700; color: <%= @integration.healthy? ? '#16a34a' : '#dc2626' %>;">
          <%= @integration.healthy? ? 'OK' : 'Ошибка' %>
        </div>
      </div>
    </div>
    <% if @integration.last_test_at %>
      <div style="font-size: 0.875rem; color: var(--gray-600);">
        Проверено: <%= time_ago_in_words(@integration.last_test_at) %> назад
      </div>
    <% end %>
  </div>
</div>

<!-- Quick Links -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-6); margin-bottom: var(--space-8);">
  <%= link_to logs_admin_integration_path(@integration), class: "card", style: "padding: var(--space-6); text-decoration: none; transition: all 0.2s;" do %>
    <div style="display: flex; align-items: center; gap: var(--space-4); margin-bottom: var(--space-3);">
      <div style="width: 48px; height: 48px; background: rgba(59, 130, 246, 0.1); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
      </div>
      <div>
        <div style="font-weight: 600; color: var(--gray-900); font-size: 1.125rem; margin-bottom: var(--space-1);">Логи событий</div>
        <div style="font-size: 0.875rem; color: var(--gray-600);">
          <%= pluralize(@integration.integration_logs.count, 'событие', 'события', 'событий') %>
        </div>
      </div>
    </div>
  <% end %>

  <%= link_to statistics_admin_integration_path(@integration), class: "card", style: "padding: var(--space-6); text-decoration: none; transition: all 0.2s;" do %>
    <div style="display: flex; align-items: center; gap: var(--space-4); margin-bottom: var(--space-3);">
      <div style="width: 48px; height: 48px; background: rgba(168, 85, 247, 0.1); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#A855F7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="20" x2="18" y2="10"></line>
          <line x1="12" y1="20" x2="12" y2="4"></line>
          <line x1="6" y1="20" x2="6" y2="14"></line>
        </svg>
      </div>
      <div>
        <div style="font-weight: 600; color: var(--gray-900); font-size: 1.125rem; margin-bottom: var(--space-1);">Статистика</div>
        <div style="font-size: 0.875rem; color: var(--gray-600);">
          Детальная аналитика
        </div>
      </div>
    </div>
  <% end %>
</div>

<!-- Recent Logs -->
<div class="card" style="padding: var(--space-6);">
  <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-4);">
    <h2 style="font-size: 1.125rem; font-weight: 600; color: var(--gray-900);">
      Последние события
    </h2>
    <%= link_to 'Все логи →', logs_admin_integration_path(@integration), style: "color: var(--primary); text-decoration: none; font-weight: 500; font-size: 0.875rem;" %>
  </div>

  <% if @recent_logs.any? %>
    <div style="overflow-x: auto;">
      <table style="width: 100%; border-collapse: collapse; min-width: 700px;">
        <thead>
          <tr style="border-bottom: 1px solid var(--gray-200);">
            <th style="padding: var(--space-4); text-align: left; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase;">Время</th>
            <th style="padding: var(--space-4); text-align: left; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase;">Тип события</th>
            <th style="padding: var(--space-4); text-align: left; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase;">Статус</th>
            <th style="padding: var(--space-4); text-align: left; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase;">Сообщение</th>
            <th style="padding: var(--space-4); text-align: right; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase;">Длительность</th>
          </tr>
        </thead>
        <tbody>
          <% @recent_logs.each do |log| %>
            <tr style="border-bottom: 1px solid var(--gray-100);">
              <td style="padding: var(--space-4); font-size: 0.875rem; color: var(--gray-700);">
                <%= l(log.created_at, format: :short) %>
              </td>
              <td style="padding: var(--space-4); font-size: 0.875rem;">
                <code style="padding: var(--space-1) var(--space-2); background: var(--gray-100); border-radius: var(--radius-sm); font-size: 0.75rem;">
                  <%= log.event_type %>
                </code>
              </td>
              <td style="padding: var(--space-4);">
                <span style="padding: 4px 12px; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; <%= log.success? ? 'background: rgba(34, 197, 94, 0.1); color: #16a34a;' : 'background: rgba(239, 68, 68, 0.1); color: #dc2626;' %>">
                  <%= log.success? ? 'Success' : 'Failed' %>
                </span>
              </td>
              <td style="padding: var(--space-4); font-size: 0.875rem; color: var(--gray-700);">
                <%= truncate(log.message, length: 60) %>
              </td>
              <td style="padding: var(--space-4); text-align: right; font-size: 0.875rem; color: var(--gray-600);">
                <%= log.duration_ms ? "#{log.duration_ms}ms" : '—' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div style="text-align: center; padding: var(--space-12); color: var(--gray-500);">
      <p>Нет событий для отображения</p>
    </div>
  <% end %>
</div>
