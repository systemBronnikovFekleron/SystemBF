<% content_for :title, "Управление пользователями" %>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-8);">
  <h1 style="font-size: 1.875rem; font-weight: 700; color: var(--gray-900);">
    Пользователи
  </h1>
</div>

<!-- Фильтры и поиск -->
<%= form_with url: admin_users_path, method: :get, class: "admin-filters", style: "grid-template-columns: 2fr 1fr auto; align-items: end;" do |f| %>
  <div>
    <%= f.label :search, "Поиск" %>
    <%= f.text_field :search, value: params[:search], placeholder: "Email или имя...", class: "form-input" %>
  </div>

  <div>
    <%= f.label :classification, "Классификация" %>
    <%= f.select :classification, [
      ['Все', ''],
      ['Гость', 'guest'],
      ['Клиент', 'client'],
      ['Участник клуба', 'club_member'],
      ['Представитель', 'representative'],
      ['Стажер', 'trainee'],
      ['Инструктор 1 кат', 'instructor_1'],
      ['Инструктор 2 кат', 'instructor_2'],
      ['Инструктор 3 кат', 'instructor_3'],
      ['Специалист', 'specialist'],
      ['Эксперт-Диагност', 'expert'],
      ['Директор Центра', 'center_director'],
      ['Куратор', 'curator'],
      ['Менеджер', 'manager'],
      ['Администратор', 'admin']
    ], {}, class: "form-select" %>
  </div>

  <%= f.submit "Фильтровать", class: "btn btn-primary" %>
<% end %>

<!-- Таблица пользователей -->
<div class="card">
  <table class="admin-table">
    <thead>
      <tr>
        <th>Email</th>
        <th>Классификация</th>
        <th>Баланс</th>
        <th>Рейтинг</th>
        <th>Регистрация</th>
        <th style="text-align: right;">Действия</th>
      </tr>
    </thead>
    <tbody>
      <% @users.each do |user| %>
        <tr>
          <td>
            <div style="font-weight: 500; color: var(--gray-900);"><%= user.email %></div>
            <% if user.first_name.present? || user.last_name.present? %>
              <div style="font-size: 0.875rem; color: var(--gray-600);"><%= user.full_name %></div>
            <% end %>
          </td>
          <td>
            <span style="<%= classification_badge_style(user.classification) %> padding: 4px 12px; border-radius: 9999px; font-size: 0.75rem; font-weight: 500;">
              <%= classification_label(user.classification) %>
            </span>
          </td>
          <td style="font-weight: 500; color: var(--gray-900);">
            <%= humanized_money_with_symbol(user.wallet.balance) %>
          </td>
          <td style="color: var(--gray-700);">
            <%= user.rating.points %> баллов (ур. <%= user.rating.level %>)
          </td>
          <td style="font-size: 0.875rem; color: var(--gray-600);">
            <%= l(user.created_at, format: :short) %>
          </td>
          <td style="text-align: right;">
            <div style="display: flex; gap: var(--space-2); justify-content: flex-end;">
              <%= link_to "Просмотр", admin_user_path(user), class: "btn btn-sm btn-outline" %>
              <%= link_to "Редактировать", edit_admin_user_path(user), class: "btn btn-sm btn-outline" %>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <% if @users.empty? %>
    <div style="padding: var(--space-12); text-align: center; color: var(--gray-500);">
      Пользователи не найдены
    </div>
  <% end %>
</div>

<%= paginate @users %>
