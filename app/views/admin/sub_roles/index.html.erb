<% content_for :title, "Управление подролями" %>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-8);">
  <h1 style="font-size: 1.875rem; font-weight: 700; color: var(--gray-900);">
    Подроли
  </h1>
  <%= link_to "Создать роль", new_admin_sub_role_path, style: "padding: var(--space-3) var(--space-5); background: var(--primary); color: white; text-decoration: none; border-radius: var(--radius-md); font-weight: 500; transition: all 0.2s;" %>
</div>

<!-- Статистика -->
<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-4); margin-bottom: var(--space-6);">
  <div class="card" style="padding: var(--space-5);">
    <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: var(--space-2);"><%= @stats[:total_roles] %></div>
    <div style="font-size: 0.875rem; color: var(--gray-600);">Всего ролей</div>
  </div>
  <div class="card" style="padding: var(--space-5);">
    <div style="font-size: 2rem; font-weight: 700; color: var(--color-warning); margin-bottom: var(--space-2);"><%= @stats[:system_roles] %></div>
    <div style="font-size: 0.875rem; color: var(--gray-600);">Системных</div>
  </div>
  <div class="card" style="padding: var(--space-5);">
    <div style="font-size: 2rem; font-weight: 700; color: var(--secondary); margin-bottom: var(--space-2);"><%= @stats[:custom_roles] %></div>
    <div style="font-size: 0.875rem; color: var(--gray-600);">Кастомных</div>
  </div>
</div>

<!-- Таблица подролей -->
<div class="card">
  <table style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr style="border-bottom: 1px solid var(--gray-200);">
        <th style="padding: var(--space-4); text-align: left; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase; width: 60px;">ID</th>
        <th style="padding: var(--space-4); text-align: left; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase;">Название</th>
        <th style="padding: var(--space-4); text-align: left; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase;">Отображаемое имя</th>
        <th style="padding: var(--space-4); text-align: left; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase; width: 80px;">Уровень</th>
        <th style="padding: var(--space-4); text-align: left; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase; width: 120px;">Тип</th>
        <th style="padding: var(--space-4); text-align: center; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase; width: 100px;">Польз.</th>
        <th style="padding: var(--space-4); text-align: center; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase; width: 100px;">Контент</th>
        <th style="padding: var(--space-4); text-align: right; font-size: 0.75rem; font-weight: 600; color: var(--gray-600); text-transform: uppercase;">Действия</th>
      </tr>
    </thead>
    <tbody>
      <% @sub_roles.each do |role| %>
        <tr style="border-bottom: 1px solid var(--gray-100);">
          <td style="padding: var(--space-4); color: var(--gray-600); font-size: 0.875rem;"><%= role.id %></td>
          <td style="padding: var(--space-4);">
            <code style="padding: 2px 6px; background: var(--gray-100); border-radius: var(--radius-sm); font-size: 0.8125rem; color: var(--gray-800);"><%= role.name %></code>
          </td>
          <td style="padding: var(--space-4); font-weight: 500; color: var(--gray-900);"><%= role.display_name %></td>
          <td style="padding: var(--space-4);">
            <span style="padding: 4px 8px; background: rgba(79, 70, 229, 0.1); color: var(--primary); border-radius: var(--radius-md); font-size: 0.75rem; font-weight: 600;"><%= role.level %></span>
          </td>
          <td style="padding: var(--space-4);">
            <% if role.system_role? %>
              <span style="padding: 4px 12px; background: rgba(245, 158, 11, 0.1); color: #D97706; border-radius: 9999px; font-size: 0.75rem; font-weight: 500;">Системная</span>
            <% else %>
              <span style="padding: 4px 12px; background: rgba(147, 51, 234, 0.1); color: var(--secondary); border-radius: 9999px; font-size: 0.75rem; font-weight: 500;">Кастомная</span>
            <% end %>
          </td>
          <td style="padding: var(--space-4); text-align: center; color: var(--gray-700); font-weight: 500;"><%= role.users_count %></td>
          <td style="padding: var(--space-4); text-align: center; color: var(--gray-700); font-weight: 500;"><%= role.content_count %></td>
          <td style="padding: var(--space-4); text-align: right;">
            <div style="display: flex; gap: var(--space-2); justify-content: flex-end;">
              <%= link_to "Показать", admin_sub_role_path(role), style: "padding: var(--space-2) var(--space-3); color: var(--primary); text-decoration: none; font-size: 0.875rem;" %>
              <% unless role.system_role? %>
                <%= link_to "Изменить", edit_admin_sub_role_path(role), style: "padding: var(--space-2) var(--space-3); color: var(--primary); text-decoration: none; font-size: 0.875rem;" %>
                <%= button_to "Удалить", admin_sub_role_path(role), method: :delete,
                    data: { confirm: 'Вы уверены?' },
                    style: "padding: var(--space-2) var(--space-3); background: none; border: none; color: var(--color-error); cursor: pointer; font-size: 0.875rem;" %>
              <% end %>
            </div>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <% if @sub_roles.empty? %>
    <div style="padding: var(--space-12); text-align: center; color: var(--gray-500);">
      Роли не найдены
    </div>
  <% end %>
</div>

<%= paginate @sub_roles %>
