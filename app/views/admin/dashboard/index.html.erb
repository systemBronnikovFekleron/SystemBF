<% content_for :title, "Dashboard" %>

<h1 style="font-size: 1.875rem; font-weight: 700; margin-bottom: var(--space-8); color: var(--gray-900);">
  Dashboard
</h1>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: var(--space-6); margin-bottom: var(--space-8);">
  <!-- –ü—Ä–æ–¥—É–∫—Ç—ã -->
  <div class="card" style="padding: var(--space-6);">
    <div style="display: flex; align-items: center; gap: var(--space-4); margin-bottom: var(--space-4);">
      <div style="width: 48px; height: 48px; background: var(--blue-50); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--blue-600)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
        </svg>
      </div>
      <div>
        <div style="font-size: 0.75rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-1);">
          –ü—Ä–æ–¥—É–∫—Ç—ã
        </div>
        <div style="font-size: 1.875rem; font-weight: 700; color: var(--gray-900);">
          <%= @stats[:total_products] %>
        </div>
      </div>
    </div>
    <div style="display: flex; gap: var(--space-3); font-size: 0.875rem;">
      <span style="color: var(--color-success);">
        <%= @stats[:published_products] %> –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
      </span>
      <span style="color: var(--gray-500);">¬∑</span>
      <span style="color: var(--gray-600);">
        <%= @stats[:draft_products] %> —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤
      </span>
    </div>
  </div>

  <!-- –ö–ª–∏–µ–Ω—Ç—ã -->
  <div class="card" style="padding: var(--space-6);">
    <div style="display: flex; align-items: center; gap: var(--space-4); margin-bottom: var(--space-4);">
      <div style="width: 48px; height: 48px; background: rgba(245, 158, 11, 0.1); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#F59E0B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
      </div>
      <div>
        <div style="font-size: 0.75rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-1);">
          –ö–ª–∏–µ–Ω—Ç—ã
        </div>
        <div style="font-size: 1.875rem; font-weight: 700; color: var(--gray-900);">
          <%= @stats[:total_users] %>
        </div>
      </div>
    </div>
    <div style="font-size: 0.875rem; color: var(--color-success);">
      +<%= @stats[:new_users_this_month] %> –∑–∞ –º–µ—Å—è—Ü
    </div>
  </div>

  <!-- –ó–∞–∫–∞–∑—ã -->
  <div class="card" style="padding: var(--space-6);">
    <div style="display: flex; align-items: center; gap: var(--space-4); margin-bottom: var(--space-4);">
      <div style="width: 48px; height: 48px; background: rgba(34, 197, 94, 0.1); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#22C55E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
          <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
        </svg>
      </div>
      <div>
        <div style="font-size: 0.75rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-1);">
          –ó–∞–∫–∞–∑—ã
        </div>
        <div style="font-size: 1.875rem; font-weight: 700; color: var(--gray-900);">
          <%= @stats[:total_orders] %>
        </div>
      </div>
    </div>
    <div style="font-size: 0.875rem; color: var(--color-success);">
      <%= @stats[:paid_orders] %> –æ–ø–ª–∞—á–µ–Ω–æ
    </div>
  </div>

  <!-- –í—ã—Ä—É—á–∫–∞ -->
  <div class="card" style="padding: var(--space-6);">
    <div style="display: flex; align-items: center; gap: var(--space-4); margin-bottom: var(--space-4);">
      <div style="width: 48px; height: 48px; background: rgba(168, 85, 247, 0.1); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#A855F7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="1" x2="12" y2="23"></line>
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
      </div>
      <div>
        <div style="font-size: 0.75rem; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-1);">
          –í—ã—Ä—É—á–∫–∞ –∑–∞ –º–µ—Å—è—Ü
        </div>
        <div style="font-size: 1.875rem; font-weight: 700; color: var(--gray-900);">
          <%= humanized_money_with_symbol(Money.new(@stats[:revenue_this_month], 'RUB')) %>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Charts Section -->
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-6); margin-bottom: var(--space-8);">
  <!-- Revenue Chart -->
  <div class="card" style="padding: var(--space-6);"
       data-controller="chart"
       data-chart-type-value="line"
       data-chart-data-value="<%= @revenue_by_day.to_json %>"
       data-chart-label-value="–í—ã—Ä—É—á–∫–∞ (‚ÇΩ)">
    <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-5); color: var(--gray-900);">
      üìà –í—ã—Ä—É—á–∫–∞ –∑–∞ 30 –¥–Ω–µ–π
    </h2>
    <canvas id="revenue-chart" style="width: 100%; height: 300px;"></canvas>
  </div>

  <!-- Users by Classification -->
  <div class="card" style="padding: var(--space-6);">
    <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-5); color: var(--gray-900);">
      üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ —Ç–∏–ø—É
    </h2>
    <div style="display: flex; flex-direction: column; gap: var(--space-3);">
      <% @users_by_classification.sort_by { |_, count| -count }.first(5).each do |classification, count| %>
        <div>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-1);">
            <span style="font-size: 0.875rem; color: var(--gray-700);"><%= classification_label(classification) %></span>
            <span style="font-weight: 600; color: var(--gray-900);"><%= count %></span>
          </div>
          <div style="width: 100%; height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden;">
            <div style="width: <%= (count.to_f / @stats[:total_users] * 100).round %>%; height: 100%; background: var(--blue-500);"></div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- Top Products Chart -->
<% if @top_products.any? %>
  <div class="card" style="padding: var(--space-6); margin-bottom: var(--space-8);"
       data-controller="chart"
       data-chart-type-value="bar"
       data-chart-data-value="<%= @top_products.to_json %>"
       data-chart-label-value="–í—ã—Ä—É—á–∫–∞ (‚ÇΩ)">
    <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-5); color: var(--gray-900);">
      üèÜ –¢–æ–ø-10 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ –≤—ã—Ä—É—á–∫–µ
    </h2>
    <canvas id="top-products-chart" style="width: 100%; height: 400px;"></canvas>
  </div>
<% end %>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-6);">
  <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã -->
  <div class="card" style="padding: var(--space-6);">
    <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-4); color: var(--gray-900);">
      –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã
    </h2>

    <% if @recent_orders.empty? %>
      <p style="text-align: center; color: var(--gray-500); padding: var(--space-8) 0;">
        –ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤
      </p>
    <% else %>
      <div style="display: grid; gap: var(--space-3);">
        <% @recent_orders.each do |order| %>
          <%= link_to order_path(order), style: "display: flex; justify-content: space-between; align-items: center; padding: var(--space-3); background: var(--gray-50); border-radius: var(--radius-md); text-decoration: none; transition: all 0.2s;" do %>
            <div>
              <div style="font-weight: 500; color: var(--gray-900); margin-bottom: var(--space-1);">
                ‚Ññ <%= order.order_number %>
              </div>
              <div style="font-size: 0.875rem; color: var(--gray-600);">
                <%= order.user.email %>
              </div>
            </div>
            <div style="text-align: right;">
              <div style="font-weight: 600; color: var(--gray-900); margin-bottom: var(--space-1);">
                <%= humanized_money_with_symbol(order.total) %>
              </div>
              <div style="font-size: 0.75rem; <%= order_status_style(order.status) %> padding: 2px 8px; border-radius: 9999px;">
                <%= t("order_status.#{order.status}") %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
  <div class="card" style="padding: var(--space-6);">
    <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: var(--space-4); color: var(--gray-900);">
      –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    </h2>

    <% if @recent_users.empty? %>
      <p style="text-align: center; color: var(--gray-500); padding: var(--space-8) 0;">
        –ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      </p>
    <% else %>
      <div style="display: grid; gap: var(--space-3);">
        <% @recent_users.each do |user| %>
          <%= link_to admin_user_path(user), style: "display: flex; justify-content: space-between; align-items: center; padding: var(--space-3); background: var(--gray-50); border-radius: var(--radius-md); text-decoration: none; transition: all 0.2s;" do %>
            <div>
              <div style="font-weight: 500; color: var(--gray-900); margin-bottom: var(--space-1);">
                <%= user.email %>
              </div>
              <div style="font-size: 0.875rem; color: var(--gray-600);">
                <%= t("user_classification.#{user.classification}") %>
              </div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 0.875rem; color: var(--gray-600);">
                <%= l(user.created_at, format: :short) %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
