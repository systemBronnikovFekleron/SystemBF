<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-8);">
  <h1 style="font-size: 1.875rem; font-weight: 700; color: var(--gray-900);">
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
  </h1>
  <%= link_to '–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é', new_admin_category_path, class: 'btn btn-primary' %>
</div>

<!-- Stats -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-6); margin-bottom: var(--space-8);">
  <div class="admin-stat-card">
    <div style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: var(--space-2);">–í—Å–µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</div>
    <div style="font-size: 2rem; font-weight: 700; color: var(--primary);"><%= @categories_count %></div>
  </div>

  <div class="admin-stat-card">
    <div style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: var(--space-2);">–í—Å–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</div>
    <div style="font-size: 2rem; font-weight: 700; color: var(--secondary);"><%= @products_count %></div>
  </div>
</div>

<!-- Help text -->
<div style="background: rgba(79, 70, 229, 0.05); padding: var(--space-4); border-radius: var(--radius-lg); margin-bottom: var(--space-8); border-left: 4px solid var(--primary);">
  <div style="font-weight: 600; color: var(--gray-900); margin-bottom: var(--space-1);">üí° Drag & Drop</div>
  <div style="font-size: 0.875rem; color: var(--gray-700);">
    –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—è —Å—Ç—Ä–æ–∫–∏. –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
  </div>
</div>

  <!-- Categories Table -->
  <div class="card" style="overflow-x: auto;">
    <table class="admin-table" id="categories-table" style="width: 100%; min-width: 900px;">
      <thead>
        <tr>
          <th style="width: 50px;">–ü–æ—Ä—è–¥–æ–∫</th>
          <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
          <th>Slug</th>
          <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
          <th style="text-align: center;">–ü—Ä–æ–¥—É–∫—Ç–æ–≤</th>
          <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
          <th style="width: 150px;">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody id="sortable-categories">
        <% @categories.each do |category| %>
          <tr data-category-id="<%= category.id %>" class="sortable-row" style="cursor: move;">
            <td style="text-align: center; color: var(--gray-500);">
              <span style="font-size: 1.25rem;">‚ãÆ‚ãÆ</span>
            </td>
            <td>
              <div style="font-weight: 600; color: var(--gray-900);"><%= category.name %></div>
            </td>
            <td>
              <code style="font-size: 0.875rem; color: var(--secondary); background: rgba(147, 51, 234, 0.05); padding: var(--space-1) var(--space-2); border-radius: var(--radius-sm);">
                <%= category.slug %>
              </code>
            </td>
            <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
              <%= category.description || '-' %>
            </td>
            <td style="text-align: center;">
              <% if category.products.any? %>
                <%= link_to category.products.count, admin_category_path(category), class: 'badge badge-primary', style: 'text-decoration: none;' %>
              <% else %>
                <span style="color: var(--gray-400);">0</span>
              <% end %>
            </td>
            <td style="color: var(--gray-600); font-size: 0.875rem;">
              <%= l(category.created_at, format: :short) %>
            </td>
            <td>
              <div style="display: flex; gap: var(--space-2); align-items: center;">
                <%= link_to '–ü—Ä–æ—Å–º–æ—Ç—Ä', admin_category_path(category), class: 'btn btn-sm btn-outline' %>
                <%= link_to '–ò–∑–º–µ–Ω–∏—Ç—å', edit_admin_category_path(category), class: 'btn btn-sm btn-outline' %>
                <% if category.products.any? %>
                  <button type="button" disabled class="btn btn-sm" style="background: var(--gray-200); color: var(--gray-500); cursor: not-allowed; border: 1px solid var(--gray-300);" title="–£ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å—Ç—å <%= category.products.count %> –ø—Ä–æ–¥—É–∫—Ç–æ–≤">
                    –£–¥–∞–ª–∏—Ç—å
                  </button>
                <% else %>
                  <%= button_to '–£–¥–∞–ª–∏—Ç—å',
                    admin_category_path(category),
                    method: :delete,
                    data: { confirm: '–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.' },
                    class: 'btn btn-sm btn-danger',
                    form: { style: 'display: inline;' }
                  %>
                <% end %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <% if @categories.empty? %>
      <div style="padding: var(--space-12); text-align: center; color: var(--gray-600);">
        <div style="font-size: 3rem; margin-bottom: var(--space-4); opacity: 0.3;">üìÇ</div>
        <div style="font-weight: 600; margin-bottom: var(--space-2);">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π</div>
        <div style="font-size: 0.875rem;">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</div>
      </div>
    <% end %>
  </div>


<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const tbody = document.getElementById('sortable-categories');
    if (tbody) {
      const sortable = Sortable.create(tbody, {
        animation: 150,
        handle: '.sortable-row',
        onEnd: function() {
          const categoryIds = Array.from(tbody.querySelectorAll('[data-category-id]'))
            .map(row => row.dataset.categoryId);

          fetch('<%= reorder_admin_categories_path %>', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
            },
            body: JSON.stringify({ categories: categoryIds })
          }).then(response => {
            if (response.ok) {
              // Show success message (optional)
              console.log('Order updated successfully');
            }
          });
        }
      });
    }
  });
</script>
