<% content_for :title, "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–æ—Ä–º –¥–ª—è #{@product.name} - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å" %>

<div style="padding: 2rem;">
  <div style="margin-bottom: 2rem;">
    <%= link_to "‚Üê –ù–∞–∑–∞–¥ –∫ –ø—Ä–æ–¥—É–∫—Ç—É", admin_product_path(@product), class: "btn btn-secondary" %>
  </div>

  <h1 class="text-gradient" style="margin-bottom: 0.5rem;">
    üé® –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä HTML —Ñ–æ—Ä–º—ã
  </h1>
  <p style="color: var(--gray-600); margin-bottom: 2rem;">
    –ü—Ä–æ–¥—É–∫—Ç: <strong><%= @product.name %></strong>
  </p>

  <div class="grid lg:grid-cols-2 gap-6">
    <!-- Preview -->
    <div>
      <div class="card" style="margin-bottom: 1.5rem;">
        <h3 style="margin-bottom: 1rem;">üëÅ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ä–º—ã</h3>
        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2rem; border-radius: 8px;">
          <iframe srcdoc="<%= @form_html.gsub('"', '&quot;') %>"
                  style="width: 100%; height: 600px; border: none; border-radius: 8px; background: white;">
          </iframe>
        </div>
      </div>

      <!-- Info -->
      <div class="card" style="background: rgba(59, 130, 246, 0.1);">
        <h4 style="color: #3B82F6; margin-bottom: 1rem;">‚ÑπÔ∏è –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</h4>
        <ol style="padding-left: 1.5rem; color: var(--gray-700); display: flex; flex-direction: column; gap: 0.75rem;">
          <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ HTML –∫–æ–¥ —Å–ø—Ä–∞–≤–∞</li>
          <li>–í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ –Ω–∞ –≤–∞—à —Å–∞–π—Ç (WordPress, –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å)</li>
          <li>–§–æ—Ä–º–∞ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞—è–≤–∫–∏ –≤ —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</li>
          <li>
            <% if @product.auto_approve %>
              <strong style="color: var(--color-success);">‚úì –ê–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ</strong> - –∑–∞—è–≤–∫–∏ –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            <% else %>
              <strong style="color: var(--color-warning);">‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–¥–æ–±—Ä–µ–Ω–∏–µ</strong> - –∑–∞—è–≤–∫–∏ –±—É–¥—É—Ç –æ–∂–∏–¥–∞—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            <% end %>
          </li>
        </ol>
      </div>
    </div>

    <!-- HTML Code -->
    <div>
      <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h3>üìÑ HTML –∫–æ–¥</h3>
          <button onclick="copyToClipboard()"
                  class="btn btn-primary btn-sm"
                  id="copyButton">
            üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
          </button>
        </div>

        <div style="position: relative;">
          <pre id="htmlCode" style="
            background: var(--gray-900);
            color: var(--gray-100);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.875rem;
            line-height: 1.6;
            max-height: 70vh;
            margin: 0;
          "><code><%= @form_html %></code></pre>
        </div>
      </div>

      <!-- Product Settings -->
      <div class="card" style="margin-top: 1.5rem;">
        <h4 style="margin-bottom: 1rem;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞</h4>
        <dl style="display: grid; grid-template-columns: auto 1fr; gap: 0.75rem 1.5rem;">
          <dt style="font-weight: 600; color: var(--gray-700);">–ê–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–∏–µ:</dt>
          <dd>
            <% if @product.auto_approve %>
              <span class="badge badge-success">‚úì –í–∫–ª—é—á–µ–Ω–æ</span>
            <% else %>
              <span class="badge badge-warning">‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–¥–æ–±—Ä–µ–Ω–∏–µ</span>
            <% end %>
          </dd>

          <dt style="font-weight: 600; color: var(--gray-700);">–ö–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è:</dt>
          <dd>
            <% if @product.form_fields.present? && @product.form_fields.any? %>
              <span class="badge badge-info"><%= @product.form_fields.length %> –ø–æ–ª–µ–π</span>
            <% else %>
              <span class="badge badge-secondary">–¢–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—è</span>
            <% end %>
          </dd>

          <dt style="font-weight: 600; color: var(--gray-700);">–¶–µ–Ω–∞:</dt>
          <dd style="font-weight: 700; color: var(--primary);">
            <%= humanized_money_with_symbol(@product.price) %>
          </dd>
        </dl>

        <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--gray-200);">
          <%= link_to "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç ‚Üí",
                      edit_admin_product_path(@product),
                      class: "btn btn-secondary",
                      style: "width: 100%;" %>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function copyToClipboard() {
    const code = document.getElementById('htmlCode').textContent;
    const button = document.getElementById('copyButton');

    navigator.clipboard.writeText(code).then(() => {
      const originalText = button.textContent;
      button.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
      button.style.background = 'var(--color-success)';

      setTimeout(() => {
        button.textContent = originalText;
        button.style.background = '';
      }, 2000);
    }).catch(err => {
      console.error('Failed to copy:', err);
      alert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–¥–µ–ª–∏—Ç—å —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é.');
    });
  }
</script>
