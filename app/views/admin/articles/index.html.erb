<div style="padding: 2rem;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1 style="font-size: 1.875rem; font-weight: 700; color: var(--gray-900);">Управление статьями</h1>
    <%= link_to 'Создать статью', new_admin_article_path, class: 'btn btn-primary' %>
  </div>

  <!-- Stats -->
  <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
    <div class="admin-stat-card">
      <div style="font-size: 0.875rem; color: var(--gray-600);">Всего статей</div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--primary);"><%= @total_count %></div>
    </div>
    <div class="admin-stat-card">
      <div style="font-size: 0.875rem; color: var(--gray-600);">Опубликовано</div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--secondary);"><%= @published_count %></div>
    </div>
    <div class="admin-stat-card">
      <div style="font-size: 0.875rem; color: var(--gray-600);">Черновиков</div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--accent);"><%= @draft_count %></div>
    </div>
  </div>

  <!-- Filters -->
  <%= form_with url: admin_articles_path, method: :get, local: true do |f| %>
    <div class="admin-filters">
      <div>
        <%= f.label :type, 'Тип' %>
        <%= f.select :type, options_for_select([['Все', ''], ['Новости', 'news'], ['Полезные материалы', 'useful_material'], ['Объявления', 'announcement']], params[:type]), {}, class: 'form-select' %>
      </div>
      <div>
        <%= f.label :status, 'Статус' %>
        <%= f.select :status, options_for_select([['Все', ''], ['Черновик', 'draft'], ['Опубликовано', 'published'], ['Архив', 'archived']], params[:status]), {}, class: 'form-select' %>
      </div>
      <div>
        <%= f.label :featured, 'Избранные' %>
        <%= f.select :featured, options_for_select([['Все', ''], ['Только избранные', 'true']], params[:featured]), {}, class: 'form-select' %>
      </div>
      <div style="display: flex; align-items: flex-end;">
        <%= f.submit 'Фильтровать', class: 'btn btn-secondary' %>
      </div>
    </div>
  <% end %>

  <!-- Bulk Actions -->
  <%= form_with url: bulk_action_admin_articles_path, method: :post, id: 'bulk-form' do %>
    <div style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem;">
      <select name="bulk_action" class="form-select" style="max-width: 200px;">
        <option value="">Массовые действия</option>
        <option value="publish">Опубликовать</option>
        <option value="archive">Архивировать</option>
        <option value="draft">В черновики</option>
        <option value="feature">Отметить избранными</option>
        <option value="unfeature">Убрать из избранных</option>
        <option value="delete">Удалить</option>
      </select>
      <button type="submit" class="btn btn-outline" onclick="return confirm('Применить действие к выбранным статьям?')">Применить</button>
      <span id="selected-count" style="color: var(--gray-600); line-height: 2.5rem; margin-left: 0.5rem;"></span>
    </div>

    <div class="card">
      <table class="admin-table">
        <thead>
          <tr>
            <th style="width: 40px;"><input type="checkbox" id="select-all"></th>
            <th>Заголовок</th>
            <th>Тип</th>
            <th>Статус</th>
            <th>Автор</th>
            <th>Дата</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody>
          <% @articles.each do |article| %>
            <tr>
              <td><input type="checkbox" name="article_ids[]" value="<%= article.id %>" class="article-checkbox"></td>
              <td>
                <div style="font-weight: 600; color: var(--gray-900);"><%= article.title %></div>
                <% if article.featured? %>
                  <span class="badge badge-warning" style="margin-top: 0.25rem;">⭐ Избранное</span>
                <% end %>
              </td>
              <td><span class="badge badge-secondary"><%= article.type_label %></span></td>
              <td>
                <% if article.status_published? %>
                  <span class="badge badge-success">Опубликовано</span>
                <% elsif article.status_draft? %>
                  <span class="badge badge-warning">Черновик</span>
                <% else %>
                  <span class="badge badge-secondary">Архив</span>
                <% end %>
              </td>
              <td style="color: var(--gray-600); font-size: 0.875rem;"><%= article.author&.full_name || 'Без автора' %></td>
              <td style="color: var(--gray-600); font-size: 0.875rem;"><%= l(article.created_at, format: :short) %></td>
              <td>
                <div style="display: flex; gap: 0.5rem;">
                  <%= link_to 'Просмотр', admin_article_path(article), class: 'btn btn-sm btn-outline' %>
                  <%= link_to 'Изменить', edit_admin_article_path(article), class: 'btn btn-sm btn-outline' %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>

  <div style="margin-top: 2rem; display: flex; justify-content: center;">
    <%= paginate @articles %>
  </div>
</div>

<script>
  const selectAll = document.getElementById('select-all');
  const checkboxes = document.querySelectorAll('.article-checkbox');
  const selectedCount = document.getElementById('selected-count');

  selectAll?.addEventListener('change', function() {
    checkboxes.forEach(cb => cb.checked = this.checked);
    updateCount();
  });

  checkboxes.forEach(cb => cb.addEventListener('change', updateCount));

  function updateCount() {
    const count = document.querySelectorAll('.article-checkbox:checked').length;
    selectedCount.textContent = count > 0 ? `Выбрано: ${count}` : '';
  }
</script>
