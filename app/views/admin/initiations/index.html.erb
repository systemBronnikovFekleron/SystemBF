<div style="padding: 2rem;">
  <div style="display: flex; justify-content: space-between; margin-bottom: 2rem;">
    <h1 style="font-size: 1.875rem; font-weight: 700;">Управление инициациями</h1>
    <%= link_to 'Назначить инициацию', new_admin_initiation_path, class: 'btn btn-primary' %>
  </div>

  <!-- Stats -->
  <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; margin-bottom: 2rem;">
    <div class="admin-stat-card">
      <div style="font-size: 0.875rem; color: var(--gray-600);">Всего</div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--primary);"><%= @total_count %></div>
    </div>
    <div class="admin-stat-card">
      <div style="font-size: 0.875rem; color: var(--gray-600);">Ожидает</div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--secondary);"><%= @pending_count %></div>
    </div>
    <div class="admin-stat-card">
      <div style="font-size: 0.875rem; color: var(--gray-600);">Завершено</div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--color-info);"><%= @completed_count %></div>
    </div>
    <div class="admin-stat-card">
      <div style="font-size: 0.875rem; color: var(--gray-600);">Пройдено</div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--color-success);"><%= @passed_count %></div>
    </div>
    <div class="admin-stat-card">
      <div style="font-size: 0.875rem; color: var(--gray-600);">Не пройдено</div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--color-error);"><%= @failed_count %></div>
    </div>
  </div>

  <!-- Filters -->
  <%= form_with url: admin_initiations_path, method: :get do |f| %>
    <div class="admin-filters" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1.5rem;">
      <div>
        <%= f.label :initiation_type, 'Тип', style: 'display: block; font-size: 0.875rem; margin-bottom: 0.25rem;' %>
        <%= f.select :initiation_type, [
          ['Все типы', ''],
          ['Первая', 'first'],
          ['Вторая', 'second'],
          ['Третья', 'third'],
          ['Продвинутая', 'advanced']
        ], {}, class: 'form-select' %>
      </div>
      <div>
        <%= f.label :status, 'Статус', style: 'display: block; font-size: 0.875rem; margin-bottom: 0.25rem;' %>
        <%= f.select :status, [
          ['Все статусы', ''],
          ['Ожидает', 'pending'],
          ['Завершено', 'completed'],
          ['Пройдено', 'passed'],
          ['Не пройдено', 'failed']
        ], {}, class: 'form-select' %>
      </div>
      <div>
        <%= f.label :level, 'Уровень', style: 'display: block; font-size: 0.875rem; margin-bottom: 0.25rem;' %>
        <%= f.select :level, [['Все уровни', '']] + (1..10).map { |l| ["Уровень #{l}", l] }, {}, class: 'form-select' %>
      </div>
      <div>
        <%= f.label :date_from, 'Дата с', style: 'display: block; font-size: 0.875rem; margin-bottom: 0.25rem;' %>
        <%= f.date_field :date_from, value: params[:date_from], class: 'form-input' %>
      </div>
      <div>
        <%= f.label :date_to, 'Дата по', style: 'display: block; font-size: 0.875rem; margin-bottom: 0.25rem;' %>
        <%= f.date_field :date_to, value: params[:date_to], class: 'form-input' %>
      </div>
      <div style="display: flex; align-items: flex-end;">
        <%= f.submit 'Фильтровать', class: 'btn btn-secondary' %>
      </div>
    </div>
  <% end %>

  <!-- Bulk Actions -->
  <%= form_with url: bulk_action_admin_initiations_path, method: :post do %>
    <div style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem;">
      <select name="bulk_action" class="form-select" style="max-width: 200px;">
        <option value="">Действия</option>
        <option value="complete">Завершить</option>
        <option value="pass">Пройдено</option>
        <option value="fail">Не пройдено</option>
        <option value="delete">Удалить</option>
      </select>
      <button type="submit" class="btn btn-outline">Применить</button>
    </div>

    <!-- Table -->
    <div class="card">
      <table class="admin-table">
        <thead>
          <tr>
            <th style="width: 40px;"><input type="checkbox" id="select-all"></th>
            <th>ID</th>
            <th>Пользователь</th>
            <th>Тип</th>
            <th>Уровень</th>
            <th>Статус</th>
            <th>Дата</th>
            <th>Специалист</th>
            <th>Действия</th>
          </tr>
        </thead>
        <tbody>
          <% @initiations.each do |initiation| %>
            <tr>
              <td><input type="checkbox" name="initiation_ids[]" value="<%= initiation.id %>" class="initiation-checkbox"></td>
              <td><%= initiation.id %></td>
              <td>
                <strong><%= initiation.user.full_name %></strong>
                <br><small style="color: var(--gray-600);"><%= initiation.user.email %></small>
              </td>
              <td>
                <% case initiation.initiation_type %>
                <% when 'first' %>
                  <span class="badge badge-primary">Первая</span>
                <% when 'second' %>
                  <span class="badge badge-secondary">Вторая</span>
                <% when 'third' %>
                  <span class="badge badge-info">Третья</span>
                <% when 'advanced' %>
                  <span class="badge badge-warning">Продвинутая</span>
                <% else %>
                  <span class="badge"><%= initiation.initiation_type %></span>
                <% end %>
              </td>
              <td>
                <% if initiation.level.present? %>
                  <strong><%= initiation.level %></strong>
                <% else %>
                  <span style="color: var(--gray-500);">—</span>
                <% end %>
              </td>
              <td>
                <% if initiation.status_pending? %>
                  <span class="badge badge-secondary">Ожидает</span>
                <% elsif initiation.status_completed? %>
                  <span class="badge badge-info">Завершено</span>
                <% elsif initiation.status_passed? %>
                  <span class="badge badge-success">Пройдено</span>
                <% elsif initiation.status_failed? %>
                  <span class="badge badge-error">Не пройдено</span>
                <% end %>
              </td>
              <td>
                <% if initiation.conducted_at.present? %>
                  <%= l(initiation.conducted_at, format: :short) %>
                <% else %>
                  <span style="color: var(--gray-500);">Не проведена</span>
                <% end %>
              </td>
              <td>
                <% if initiation.conducted_by.present? %>
                  <%= initiation.conducted_by.full_name %>
                <% else %>
                  <span style="color: var(--gray-500);">—</span>
                <% end %>
              </td>
              <td>
                <div style="display: flex; gap: 0.5rem;">
                  <%= link_to 'Просмотр', admin_initiation_path(initiation), class: 'btn btn-sm btn-outline' %>
                  <%= link_to 'Изменить', edit_admin_initiation_path(initiation), class: 'btn btn-sm btn-outline' %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>

  <% if @initiations.empty? %>
    <div style="text-align: center; padding: 3rem; color: var(--gray-600);">
      Инициации не найдены
    </div>
  <% end %>

  <div style="margin-top: 2rem;"><%= paginate @initiations %></div>
</div>

<script>
  document.getElementById('select-all')?.addEventListener('change', function() {
    document.querySelectorAll('.initiation-checkbox').forEach(cb => cb.checked = this.checked);
  });
</script>
