<div style="padding: 2rem;">
  <div style="display: flex; justify-content: space-between; margin-bottom: 2rem;">
    <h1 style="font-size: 1.875rem; font-weight: 700;">Управление диагностиками</h1>
    <%= link_to 'Назначить диагностику', new_admin_diagnostic_path, class: 'btn btn-primary' %>
  </div>

  <!-- Stats -->
  <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
    <div class="admin-stat-card">
      <div style="font-size: 0.875rem; color: var(--gray-600);">Всего</div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--primary);"><%= @total_count %></div>
    </div>
    <div class="admin-stat-card">
      <div style="font-size: 0.875rem; color: var(--gray-600);">Запланировано</div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--secondary);"><%= @scheduled_count %></div>
    </div>
    <div class="admin-stat-card">
      <div style="font-size: 0.875rem; color: var(--gray-600);">Проведено</div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--color-success);"><%= @completed_count %></div>
    </div>
    <div class="admin-stat-card">
      <div style="font-size: 0.875rem; color: var(--gray-600);">Отменено</div>
      <div style="font-size: 2rem; font-weight: 700; color: var(--gray-500);"><%= @cancelled_count %></div>
    </div>
  </div>

  <!-- Filters -->
  <%= form_with url: admin_diagnostics_path, method: :get do |f| %>
    <div class="admin-filters" style="display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1.5rem;">
      <div>
        <%= f.label :diagnostic_type, 'Тип', style: 'display: block; font-size: 0.875rem; margin-bottom: 0.25rem;' %>
        <%= f.select :diagnostic_type, [
          ['Все типы', ''],
          ['Видение', 'vision'],
          ['Биоэнергетика', 'bioenergy'],
          ['Психобиокомпьютер', 'psychobiocomputer']
        ], {}, class: 'form-select' %>
      </div>
      <div>
        <%= f.label :status, 'Статус', style: 'display: block; font-size: 0.875rem; margin-bottom: 0.25rem;' %>
        <%= f.select :status, [
          ['Все статусы', ''],
          ['Запланировано', 'scheduled'],
          ['Проведено', 'completed'],
          ['Отменено', 'cancelled']
        ], {}, class: 'form-select' %>
      </div>
      <div>
        <%= f.label :date_from, 'Дата с', style: 'display: block; font-size: 0.875rem; margin-bottom: 0.25rem;' %>
        <%= f.date_field :date_from, value: params[:date_from], class: 'form-input' %>
      </div>
      <div>
        <%= f.label :date_to, 'Дата по', style: 'display: block; font-size: 0.875rem; margin-bottom: 0.25rem;' %>
        <%= f.date_field :date_to, value: params[:date_to], class: 'form-input' %>
      </div>
      <div style="display: flex; align-items: flex-end;">
        <%= f.submit 'Фильтровать', class: 'btn btn-secondary' %>
      </div>
    </div>
  <% end %>

  <!-- Table -->
  <div class="card">
    <table class="admin-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Пользователь</th>
          <th>Тип</th>
          <th>Статус</th>
          <th>Дата проведения</th>
          <th>Специалист</th>
          <th>Балл</th>
          <th>Действия</th>
        </tr>
      </thead>
      <tbody>
        <% @diagnostics.each do |diagnostic| %>
          <tr>
            <td><%= diagnostic.id %></td>
            <td>
              <strong><%= diagnostic.user.full_name %></strong>
              <br><small style="color: var(--gray-600);"><%= diagnostic.user.email %></small>
            </td>
            <td>
              <% case diagnostic.diagnostic_type %>
              <% when 'vision' %>
                <span class="badge badge-primary">Видение</span>
              <% when 'bioenergy' %>
                <span class="badge badge-secondary">Биоэнергетика</span>
              <% when 'psychobiocomputer' %>
                <span class="badge badge-info">ПБК</span>
              <% else %>
                <span class="badge"><%= diagnostic.diagnostic_type %></span>
              <% end %>
            </td>
            <td>
              <% if diagnostic.status_scheduled? %>
                <span class="badge badge-warning">Запланировано</span>
              <% elsif diagnostic.status_completed? %>
                <span class="badge badge-success">Проведено</span>
              <% elsif diagnostic.status_cancelled? %>
                <span class="badge badge-error">Отменено</span>
              <% end %>
            </td>
            <td>
              <% if diagnostic.conducted_at.present? %>
                <%= l(diagnostic.conducted_at, format: :short) %>
              <% else %>
                <span style="color: var(--gray-500);">Не назначена</span>
              <% end %>
            </td>
            <td>
              <% if diagnostic.conducted_by.present? %>
                <%= diagnostic.conducted_by.full_name %>
              <% else %>
                <span style="color: var(--gray-500);">—</span>
              <% end %>
            </td>
            <td>
              <% if diagnostic.score.present? %>
                <strong><%= diagnostic.score %></strong>
              <% else %>
                <span style="color: var(--gray-500);">—</span>
              <% end %>
            </td>
            <td>
              <div style="display: flex; gap: 0.5rem;">
                <%= link_to 'Просмотр', admin_diagnostic_path(diagnostic), class: 'btn btn-sm btn-outline' %>
                <%= link_to 'Изменить', edit_admin_diagnostic_path(diagnostic), class: 'btn btn-sm btn-outline' %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <% if @diagnostics.empty? %>
    <div style="text-align: center; padding: 3rem; color: var(--gray-600);">
      Диагностики не найдены
    </div>
  <% end %>

  <div style="margin-top: 2rem;"><%= paginate @diagnostics %></div>
</div>
