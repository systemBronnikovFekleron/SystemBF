<% if Rails.env.production? && Rails.application.credentials.dig(:google_analytics, :measurement_id).present? %>
  <!-- Google Analytics GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=<%= Rails.application.credentials.dig(:google_analytics, :measurement_id) %>"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '<%= Rails.application.credentials.dig(:google_analytics, :measurement_id) %>', {
      'send_page_view': true,
      'anonymize_ip': true  // GDPR compliance
    });
  </script>
<% end %>
