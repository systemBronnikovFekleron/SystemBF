<!DOCTYPE html>
<html>
<head>
  <title>–°–æ–±—ã—Ç–∏—è - –°–∏—Å—Ç–µ–º–∞ –ë—Ä–æ–Ω–Ω–∏–∫–æ–≤–∞</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>
</head>
<body>
  <div class="container py-5">
    <div class="page-header mb-4">
      <h1>–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π</h1>
      <p class="subtitle">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è —Å–∏—Å—Ç–µ–º—ã –ë—Ä–æ–Ω–Ω–∏–∫–æ–≤–∞</p>
      <%= link_to '–ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–π –≤–∏–¥', calendar_events_path, class: 'btn btn-outline-primary' %>
    </div>

    <!-- Filters -->
    <div class="card glass-effect mb-4">
      <div class="card-body">
        <%= form_with url: events_path, method: :get, class: 'row g-3' do |f| %>
          <div class="col-md-4">
            <%= f.select :category_id, Category.all.pluck(:name, :id), { include_blank: '–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏' }, class: 'form-select' %>
          </div>
          <div class="col-md-4">
            <%= f.select :online, [['–í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã', ''], ['–û–Ω–ª–∞–π–Ω', 'true'], ['–û—Ñ–ª–∞–π–Ω', 'false']], {}, class: 'form-select' %>
          </div>
          <div class="col-md-4">
            <%= f.submit '–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä', class: 'btn btn-primary w-100' %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Events Grid -->
    <% if @events.any? %>
      <div class="events-grid">
        <% @events.each do |event| %>
          <div class="card glass-effect event-card">
            <div class="card-body">
              <div class="event-header">
                <% if event.is_online? %>
                  <span class="badge badge-online">–û–Ω–ª–∞–π–Ω</span>
                <% else %>
                  <span class="badge badge-offline">–û—Ñ–ª–∞–π–Ω</span>
                <% end %>
                <% unless event.free? %>
                  <span class="event-price"><%= humanized_money_with_symbol(event.price) %></span>
                <% else %>
                  <span class="badge badge-free">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                <% end %>
              </div>

              <h3 class="event-title"><%= event.title %></h3>

              <div class="event-info">
                <div class="info-item">
                  <span class="info-icon">üìÖ</span>
                  <span><%= event.starts_at.strftime('%d.%m.%Y –≤ %H:%M') %></span>
                </div>
                <div class="info-item">
                  <span class="info-icon">üìç</span>
                  <span><%= event.format_location %></span>
                </div>
                <% if event.max_participants %>
                  <div class="info-item">
                    <span class="info-icon">üë•</span>
                    <span>–ú–µ—Å—Ç: <%= event.available_spots || 0 %> –∏–∑ <%= event.max_participants %></span>
                  </div>
                <% end %>
              </div>

              <% if event.description.present? %>
                <p class="event-description"><%= truncate(event.description, length: 150) %></p>
              <% end %>

              <%= link_to '–ü–æ–¥—Ä–æ–±–Ω–µ–µ', event_path(event), class: 'btn btn-primary w-100' %>
            </div>
          </div>
        <% end %>
      </div>

      <%= paginate @events %>
    <% else %>
      <div class="empty-state">
        <div class="empty-icon">üìÖ</div>
        <h3>–°–æ–±—ã—Ç–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</p>
      </div>
    <% end %>
  </div>
</body>
</html>

<style>
.events-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.event-card {
  height: 100%;
  display: flex;
  flex-direction: column;
}

.event-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.badge-online {
  background: var(--primary);
  color: white;
}

.badge-offline {
  background: var(--secondary);
  color: white;
}

.badge-free {
  background: var(--success);
  color: white;
}

.event-price {
  font-weight: bold;
  color: var(--accent);
}

.event-title {
  font-size: 1.25rem;
  margin-bottom: 1rem;
}

.event-info {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-bottom: 1rem;
}

.info-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--gray-600);
  font-size: 0.875rem;
}

.event-description {
  color: var(--gray-600);
  font-size: 0.875rem;
  margin-bottom: 1rem;
}
</style>
