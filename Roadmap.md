# Roadmap: –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ "–°–∏—Å—Ç–µ–º–∞ –ë—Ä–æ–Ω–Ω–∏–∫–æ–≤–∞"

## MVP (Phase 0-1-3)

### Phase 0: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å gems (jwt, pundit, money-rails, cloudpayments, aasm, friendly_id, kaminari)
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å RSpec
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å FactoryBot
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DatabaseCleaner
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Shoulda Matchers
- [x] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Money-Rails (RUB)

### Phase 1: Authentication ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é users
- [x] –ú–æ–¥–µ–ª—å User —Å 14 –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è–º–∏
- [x] –ú–æ–¥–µ–ª—å Profile
- [x] –ú–æ–¥–µ–ª—å Wallet (money-rails)
- [x] –ú–æ–¥–µ–ª—å Rating
- [x] JsonWebToken service
- [x] API Authentication controller (login/logout/validate_token)
- [x] API Users controller (show/update)
- [x] Pundit policies (ApplicationPolicy, UserPolicy)
- [x] JWT –≤ httpOnly cookie
- [x] Factories –¥–ª—è User
- [x] –¢–µ—Å—Ç—ã –¥–ª—è User model
- [x] –¢–µ—Å—Ç—ã –¥–ª—è Authentication API

### Phase 3: Shop ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –ú–æ–¥–µ–ª—å Category
- [x] –ú–æ–¥–µ–ª—å Product (AASM states)
- [x] –ú–æ–¥–µ–ª—å Order (AASM states)
- [x] –ú–æ–¥–µ–ª—å OrderItem
- [x] –ú–æ–¥–µ–ª—å ProductAccess
- [x] Cart (session-based)
- [x] CloudPaymentsService
- [x] Categories controller
- [x] Products controller
- [x] Cart controller
- [x] Orders controller
- [x] CloudPayments webhook
- [x] –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è shop
- [x] Factories –¥–ª—è Category, Product, Order
- [x] –¢–µ—Å—Ç—ã –¥–ª—è Category model
- [x] –¢–µ—Å—Ç—ã –¥–ª—è Product model
- [x] –¢–µ—Å—Ç—ã –¥–ª—è Order model

## –ë—É–¥—É—â–∏–µ —Ñ–∞–∑—ã

### Phase 2: –ë–∏–∑–Ω–µ—Å-–∞–∫–∫–∞—É–Ω—Ç
- [ ] –ú–æ–¥–µ–ª—å BusinessAccount
- [ ] –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è (geocoder)
- [ ] BusinessAccountMembers
- [ ] –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π –∏ —Ü–µ–Ω—Ç—Ä–æ–≤
- [ ] –ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫

### Phase 4: –ö–∞–ª–µ–Ω–¥–∞—Ä—å
- [ ] –ú–æ–¥–µ–ª—å Event
- [ ] EventRegistration
- [ ] State machines –¥–ª—è —Å–æ–±—ã—Ç–∏–π
- [ ] –û–ø–ª–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
- [ ] –ê—Ñ–∏—à–∞ —Å–æ–±—ã—Ç–∏–π

### Phase 5: –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å—á–µ—Ç (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π)
- [ ] –ú–æ–¥–µ–ª—å Transaction (–∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π)
- [ ] –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ —á–µ—Ä–µ–∑ CloudPayments
- [ ] –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
- [ ] –ë–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### Phase 6: –†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è)
- [ ] Achievements (–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è)
- [ ] Leaderboard (—Ç–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤)
- [ ] Badges (–∑–Ω–∞—á–∫–∏)
- [ ] –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –æ—á–∫–æ–≤

### Phase 7: WordPress SSO
- [ ] WordPress –ø–ª–∞–≥–∏–Ω –¥–ª—è SSO
- [ ] JWT validation endpoint (–≥–æ—Ç–æ–≤ –≤ Phase 1)
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å WordPress

### Phase 8: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Action Mailer)
- [ ] –°–∏—Å—Ç–µ–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- [ ] –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- [ ] –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [ ] GDPR/Cookie consent

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- **Phase 0**: 6/6 –∑–∞–¥–∞—á (100%) ‚úÖ
- **Phase 1**: 12/12 –∑–∞–¥–∞—á (100%) ‚úÖ
- **Phase 3**: 17/17 –∑–∞–¥–∞—á (100%) ‚úÖ
- **–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å MVP**: 35/35 –∑–∞–¥–∞—á (100%) üéâ

## MVP –ó–ê–í–ï–†–®–ï–ù! üéâ

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
- Custom JWT —Å httpOnly cookies –¥–ª—è SSO
- 14 —Ç–∏–ø–æ–≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Pundit –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- API endpoints –¥–ª—è login/logout/validate_token

**–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
- Profile (–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
- Wallet (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å—á–µ—Ç –≤ —Ä—É–±–ª—è—Ö)
- Rating (—Ä–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å —É—Ä–æ–≤–Ω—è–º–∏)

**–ú–∞–≥–∞–∑–∏–Ω:**
- Category (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤)
- Product (5 —Ç–∏–ø–æ–≤: –≤–∏–¥–µ–æ, –∫–Ω–∏–≥–∏, –∫—É—Ä—Å—ã, —É—Å–ª—É–≥–∏, –¥–æ—Å—Ç—É–ø –∫ —Å–æ–±—ã—Ç–∏—è–º)
- AASM state machine –¥–ª—è Product (draft ‚Üí published ‚Üí archived)
- Order —Å AASM state machine (pending ‚Üí processing ‚Üí paid ‚Üí completed)
- OrderItem (–ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞)
- ProductAccess (–¥–æ—Å—Ç—É–ø –∫ —Ü–∏—Ñ—Ä–æ–≤—ã–º –ø—Ä–æ–¥—É–∫—Ç–∞–º)
- Session-based Cart (–∫–æ—Ä–∑–∏–Ω–∞)
- CloudPayments –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- Webhook endpoints –¥–ª—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- 51 —Ç–µ—Å—Ç —Å –ø–æ–ª–Ω—ã–º –ø–æ–∫—Ä—ã—Ç–∏–µ–º –º–æ–¥–µ–ª–µ–π
- RSpec + FactoryBot + Shoulda Matchers
- –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ ‚úÖ

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–æ–∑–¥–∞—Ç—å seed –¥–∞–Ω–Ω—ã–µ** –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:
   - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø—Ä–æ–¥—É–∫—Ç—ã
   - –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–∞–∑–Ω—ã—Ö –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–π
   - –ü—Ä–∏–º–µ—Ä—ã –∑–∞–∫–∞–∑–æ–≤

2. **Phase 2: –ë–∏–∑–Ω–µ—Å-–∞–∫–∫–∞—É–Ω—Ç**:
   - –ú–æ–¥–µ–ª—å BusinessAccount
   - –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –¥–ª—è —Ü–µ–Ω—Ç—Ä–æ–≤ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–π
   - –ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å

3. **Phase 4: –ö–∞–ª–µ–Ω–¥–∞—Ä—å/–ê—Ñ–∏—à–∞**:
   - –°–æ–±—ã—Ç–∏—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
   - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –æ–ø–ª–∞—Ç–æ–π

4. **Phase 7: WordPress SSO –ø–ª–∞–≥–∏–Ω**:
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ WordPress —Å–∞–π—Ç–∞–º–∏
   - –ï–¥–∏–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏

- JWT —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **httpOnly cookie** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **CloudPayments** –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π, **wallet** –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –í—Å–µ —Ü–µ–Ω—ã –≤ **–∫–æ–ø–µ–π–∫–∞—Ö** (Integer) –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
- **AASM** –¥–ª—è state machines
- **FriendlyId** –¥–ª—è –ß–ü–£ URLs
- **Pundit** –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ classification
- **Money-Rails** –¥–ª—è –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—É–º–º (RUB)

## –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è Phase 1

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Rails Console:
```ruby
# –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user = User.create!(
  email: 'test@example.com',
  password: 'password123',
  classification: :client
)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏
user.profile       # –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
user.wallet        # –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
user.rating        # –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å wallet
user.wallet.balance_kopecks  # => 0
user.wallet.deposit(50000)   # –¥–æ–±–∞–≤–∏—Ç—å 500 —Ä—É–±
user.wallet.balance.format   # => "500,00 ‚ÇΩ"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å rating
user.rating.points           # => 0
user.rating.add_points(150)  # –¥–æ–±–∞–≤–∏—Ç—å 150 –æ—á–∫–æ–≤
user.rating.level            # => 2 (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API —á–µ—Ä–µ–∑ curl:
```bash
# Login
curl -X POST http://localhost:3000/api/v1/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'

# Validate Token
curl -X GET http://localhost:3000/api/v1/validate_token \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
bundle exec rspec
```
